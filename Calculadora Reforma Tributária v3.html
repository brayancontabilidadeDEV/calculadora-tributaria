<!index.html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora Reforma Tribut√°ria | Brayan Araujo Contador</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        }
        
        .dark-mode {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .dark-mode .glass-effect {
            background: rgba(30, 41, 59, 0.85);
            border: 1px solid rgba(51, 65, 85, 0.3);
        }
        
        .gradient-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
        }
        
        .gradient-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .gradient-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .gradient-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .gradient-info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }
        
        .shadow-soft {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        
        .shadow-hard {
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12);
        }
        
        .tooltip-custom {
            position: relative;
            display: inline-block;
            cursor: help;
        }
        
        .tooltip-custom .tooltip-text {
            visibility: hidden;
            width: 300px;
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
            color: white;
            text-align: left;
            border-radius: 12px;
            padding: 16px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 13px;
            line-height: 1.6;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .tooltip-custom:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
            transform: translateX(-50%) translateY(-5px);
        }
        
        .input-field {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid #e5e7eb;
            background: white;
        }
        
        .dark-mode .input-field {
            background: #334155;
            border-color: #475569;
            color: #e2e8f0;
        }
        
        .input-field:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(99, 102, 241, 0.3);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(107, 114, 128, 0.2);
        }
        
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            background: #e5e7eb;
        }
        
        .dark-mode .progress-bar {
            background: #475569;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.3px;
            text-transform: uppercase;
        }
        
        .badge-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .badge-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .badge-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .badge-info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }
        
        .badge-neutral {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
        }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .dark-mode .card {
            background: #1e293b;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
        }
        
        .card-header {
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 16px;
            margin-bottom: 20px;
        }
        
        .dark-mode .card-header {
            border-bottom-color: #334155;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid #e2e8f0;
        }
        
        .dark-mode .stat-card {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-color: #334155;
        }
        
        .timeline-item {
            position: relative;
            padding-left: 30px;
            margin-bottom: 25px;
        }
        
        .timeline-item:before {
            content: '';
            position: absolute;
            left: 0;
            top: 5px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #6366f1;
        }
        
        .timeline-item:after {
            content: '';
            position: absolute;
            left: 5px;
            top: 17px;
            width: 2px;
            height: calc(100% + 8px);
            background: #e5e7eb;
        }
        
        .timeline-item:last-child:after {
            display: none;
        }
        
        .dark-mode .timeline-item:after {
            background: #475569;
        }
        
        .comparison-arrow {
            font-size: 32px;
            color: #6366f1;
            animation: pulse 2s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-slide-up {
            animation: slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .logo-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            font-weight: 900;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.3);
        }
        
        .logo-text {
            font-family: 'Inter', sans-serif;
            font-weight: 800;
            line-height: 1.1;
        }
        
        .logo-title {
            font-size: 24px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .logo-subtitle {
            font-size: 12px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: #6b7280;
            margin-top: 4px;
        }
        
        .dark-mode .logo-subtitle {
            color: #94a3b8;
        }
        
        .metric-value {
            font-size: 32px;
            font-weight: 800;
            line-height: 1;
            margin: 10px 0;
        }
        
        .section-divider {
            height: 1px;
            background: linear-gradient(to right, transparent, #e5e7eb, transparent);
            margin: 40px 0;
        }
        
        .dark-mode .section-divider {
            background: linear-gradient(to right, transparent, #475569, transparent);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }
        
        .alert-box {
            border-left: 6px solid;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            animation: slideUp 0.6s ease;
        }
        
        .alert-success {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-left-color: #22c55e;
            color: #166534;
        }
        
        .dark-mode .alert-success {
            background: linear-gradient(135deg, #052e16 0%, #14532d 100%);
            color: #bbf7d0;
        }
        
        .alert-warning {
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            border-left-color: #f59e0b;
            color: #92400e;
        }
        
        .dark-mode .alert-warning {
            background: linear-gradient(135deg, #451a03 0%, #78350f 100%);
            color: #fde68a;
        }
        
        .alert-danger {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border-left-color: #ef4444;
            color: #991b1b;
        }
        
        .dark-mode .alert-danger {
            background: linear-gradient(135deg, #450a0a 0%, #7f1d1d 100%);
            color: #fecaca;
        }
        
        .alert-info {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-left-color: #3b82f6;
            color: #1e40af;
        }
        
        .dark-mode .alert-info {
            background: linear-gradient(135deg, #172554 0%, #1e3a8a 100%);
            color: #bfdbfe;
        }
        
        .tab-content {
            display: none;
            animation: slideUp 0.4s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .tab-button {
            padding: 12px 24px;
            border: none;
            background: transparent;
            color: #6b7280;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .tab-button.active {
            color: #6366f1;
            border-bottom-color: #6366f1;
        }
        
        .dark-mode .tab-button {
            color: #94a3b8;
        }
        
        .dark-mode .tab-button.active {
            color: #818cf8;
            border-bottom-color: #818cf8;
        }
        
        .floating-action-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
            z-index: 1000;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .floating-action-button:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 15px 40px rgba(99, 102, 241, 0.6);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e5e7eb;
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .metric-change {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 12px;
        }
        
        .metric-change.positive {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }
        
        .metric-change.negative {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }
        
        .metric-change.neutral {
            background: rgba(107, 114, 128, 0.1);
            color: #6b7280;
        }
        
        .progress-step {
            padding: 12px 16px;
            background: #f1f5f9;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
            text-align: center;
        }
        
        .progress-step.active {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        }
        
        .progress-step.completed {
            background: #10b981;
            color: white;
        }
        
        .dark-mode .progress-step {
            background: #334155;
        }
        
        /* NOVO ESTILO para timeline de implanta√ß√£o */
        .implementation-timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .implementation-timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(to bottom, #6366f1, #8b5cf6);
        }
        
        .timeline-phase {
            position: relative;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            border-left: 4px solid;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        
        .dark-mode .timeline-phase {
            background: #1e293b;
        }
        
        .timeline-phase::before {
            content: '';
            position: absolute;
            left: -36px;
            top: 25px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #6366f1;
            border: 3px solid white;
        }
        
        .dark-mode .timeline-phase::before {
            border-color: #1e293b;
        }
        
        .phase-1 { border-left-color: #10b981; }
        .phase-2 { border-left-color: #3b82f6; }
        .phase-3 { border-left-color: #8b5cf6; }
        .phase-4 { border-left-color: #f59e0b; }
        
        .roi-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .roi-negative {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
    </style>
</head>
<body class="min-h-screen text-gray-800">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        
        <!-- DISCLAIMER LEGAL -->
        <div class="alert-box alert-warning animate-slide-up">
            <div class="flex items-start gap-4">
                <div class="text-3xl">‚ö†Ô∏è</div>
                <div>
                    <h2 class="text-xl font-bold mb-3">AVISO LEGAL IMPORTANTE</h2>
                    <div class="space-y-3 text-sm">
                        <p><strong>üìã SIMULA√á√ÉO ILUSTRATIVA:</strong> Esta calculadora utiliza estimativas baseadas na EC 132/2023 e PLP 68/2024 em tramita√ß√£o.</p>
                        <p><strong>‚öñÔ∏è REGULAMENTA√á√ÉO EM CURSO:</strong> As al√≠quotas definitivas ser√£o definidas por Lei Complementar. Valores podem sofrer altera√ß√µes.</p>
                        <p><strong>üö´ N√ÉO SUBSTITUI CONSULTORIA:</strong> N√£o utilize para tomada de decis√µes sem consultar um contador ou advogado tributarista.</p>
                        <p><strong>üìä FINALIDADE EDUCACIONAL:</strong> Esta ferramenta tem prop√≥sito informativo sobre os conceitos da reforma.</p>
                        <p><strong>‚úÖ √öLTIMA ATUALIZA√á√ÉO:</strong> Dezembro/2024 - Baseado em cen√°rios estimados pela FGV e CCiF</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- HEADER COM LOGO PROFISSIONAL -->
        <header class="card shadow-hard mb-8 animate-slide-up">
            <div class="flex flex-col md:flex-row items-center justify-between gap-6">
                <div class="logo-container">
                    <div class="logo-icon">B</div>
                    <div class="logo-text">
                        <div class="logo-title">BRAYAN ARAUJO</div>
                        <div class="logo-subtitle">CONTADOR | CRC 1SPXXXXXX</div>
                    </div>
                </div>
                
                <div class="flex flex-col md:flex-row items-center gap-4">
                    <button id="darkModeToggle" class="btn-secondary px-5 py-2.5 rounded-full flex items-center gap-2">
                        <i class="fas fa-moon"></i>
                        <span>Modo Escuro</span>
                    </button>
                    
                    <div class="flex gap-2">
                        <button id="exportCSV" class="btn-primary px-5 py-2.5 rounded-full flex items-center gap-2">
                            <i class="fas fa-file-csv"></i>
                            <span>Exportar CSV</span>
                        </button>
                        <button id="exportPDF" class="btn-primary px-5 py-2.5 rounded-full flex items-center gap-2">
                            <i class="fas fa-file-pdf"></i>
                            <span>Relat√≥rio PDF</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="text-center mt-8">
                <h1 class="text-4xl font-bold mb-3 bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                    Calculadora Avan√ßada da Reforma Tribut√°ria
                </h1>
                <p class="text-gray-600 text-lg">An√°lise profissional do impacto do IVA Dual (EC 132/2023) em sua empresa</p>
            </div>
        </header>

        <!-- RESUMO EXECUTIVO -->
        <div class="card shadow-soft mb-8 animate-slide-up">
            <div class="card-header">
                <h2 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-chart-line text-indigo-600"></i>
                    Resumo Executivo da Simula√ß√£o
                </h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                <div class="stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-sm font-semibold text-gray-600">Carga Atual</span>
                        <i class="fas fa-history text-blue-500"></i>
                    </div>
                    <div class="metric-value text-blue-600" id="resumo-carga-atual">0%</div>
                    <div class="text-xs text-gray-500">M√©dia do setor: 15-25%</div>
                </div>
                
                <div class="stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-sm font-semibold text-gray-600">P√≥s-Reforma</span>
                        <i class="fas fa-rocket text-purple-500"></i>
                    </div>
                    <div class="metric-value text-purple-600" id="resumo-carga-reforma">0%</div>
                    <div class="text-xs text-gray-500">Estimativa IVA Dual</div>
                </div>
                
                <div class="stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-sm font-semibold text-gray-600">Varia√ß√£o</span>
                        <i class="fas fa-exchange-alt text-green-500"></i>
                    </div>
                    <div class="metric-value text-green-600" id="resumo-variacao">0%</div>
                    <div class="mt-2">
                        <span class="badge badge-neutral" id="resumo-badge">NEUTRO</span>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <span class="text-sm font-semibold text-gray-600">Impacto Anual</span>
                        <i class="fas fa-chart-bar text-orange-500"></i>
                    </div>
                    <div class="metric-value text-orange-600" id="resumo-impacto-anual">R$ 0</div>
                    <div class="text-xs text-gray-500">Economia/Aumento em 12 meses</div>
                </div>
            </div>
        </div>

        <!-- BARRA DE PROGRESSO DA TRANSI√á√ÉO -->
        <div class="card shadow-soft mb-8 animate-slide-up">
            <div class="card-header">
                <h2 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-calendar-alt text-indigo-600"></i>
                    Linha do Tempo da Transi√ß√£o (2026-2033)
                </h2>
            </div>
            
            <div class="transition-progress mb-6">
                <div class="flex flex-wrap gap-2 mb-6">
                    <div class="progress-step active" data-year="2026" onclick="selecionarAnoTransicao(2026)">
                        <div class="font-bold text-lg">2026</div>
                        <div class="text-xs mt-1">Fase Teste</div>
                    </div>
                    <div class="progress-step" data-year="2027" onclick="selecionarAnoTransicao(2027)">
                        <div class="font-bold text-lg">2027</div>
                        <div class="text-xs mt-1">CBS Inicia</div>
                    </div>
                    <div class="progress-step" data-year="2029" onclick="selecionarAnoTransicao(2029)">
                        <div class="font-bold text-lg">2029</div>
                        <div class="text-xs mt-1">IBS Inicia</div>
                    </div>
                    <div class="progress-step" data-year="2033" onclick="selecionarAnoTransicao(2033)">
                        <div class="font-bold text-lg">2033</div>
                        <div class="text-xs mt-1">Sistema Completo</div>
                    </div>
                </div>
                
                <div class="text-center">
                    <p class="text-gray-600" id="progress-description">
                        Sistema atual vigente. Em 2026 inicia fase de testes com 0,1% de CBS e IBS.
                    </p>
                </div>
            </div>
        </div>

        <!-- CEN√ÅRIOS DE AL√çQUOTA -->
        <div class="card shadow-soft mb-8 animate-slide-up">
            <div class="card-header">
                <h2 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-bullseye text-red-600"></i>
                    Cen√°rio de Al√≠quota IVA
                </h2>
            </div>
            
            <div class="grid md:grid-cols-3 gap-6 mb-6">
                <div class="card cursor-pointer hover:shadow-hard transition-all" onclick="selecionarCenario('pessimista')">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-lg flex items-center gap-2">
                            <i class="fas fa-exclamation-triangle text-yellow-600"></i>
                            Pessimista
                        </h3>
                        <input type="radio" name="cenario" value="pessimista" id="cenario-pessimista">
                    </div>
                    <div class="text-3xl font-bold text-yellow-600 mb-2">28,0%</div>
                    <p class="text-sm text-gray-600 mb-4">Cen√°rio de alta carga tribut√°ria (pior caso)</p>
                    <div class="text-xs bg-yellow-50 text-yellow-800 p-3 rounded-lg">
                        <i class="fas fa-info-circle mr-1"></i> Estimativa para compensa√ß√£o de perdas fiscais
                    </div>
                </div>
                
                <div class="card cursor-pointer hover:shadow-hard transition-all border-2 border-blue-500" onclick="selecionarCenario('base')">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-lg flex items-center gap-2">
                            <i class="fas fa-chart-bar text-blue-600"></i>
                            Base (Refer√™ncia)
                        </h3>
                        <input type="radio" name="cenario" value="base" id="cenario-base" checked>
                    </div>
                    <div class="text-3xl font-bold text-blue-600 mb-2">26,5%</div>
                    <p class="text-sm text-gray-600 mb-4">Estimativa FGV/CCiF (cen√°rio mais prov√°vel)</p>
                    <div class="text-xs bg-blue-50 text-blue-800 p-3 rounded-lg">
                        <i class="fas fa-check-circle mr-1"></i> Baseada em estudos t√©cnicos oficiais
                    </div>
                </div>
                
                <div class="card cursor-pointer hover:shadow-hard transition-all" onclick="selecionarCenario('otimista')">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-lg flex items-center gap-2">
                            <i class="fas fa-chart-line text-green-600"></i>
                            Otimista
                        </h3>
                        <input type="radio" name="cenario" value="otimista" id="cenario-otimista">
                    </div>
                    <div class="text-3xl font-bold text-green-600 mb-2">25,0%</div>
                    <p class="text-sm text-gray-600 mb-4">Cen√°rio de efici√™ncia m√°xima (melhor caso)</p>
                    <div class="text-xs bg-green-50 text-green-800 p-3 rounded-lg">
                        <i class="fas fa-star mr-1"></i> Requer redu√ß√£o de gastos p√∫blicos
                    </div>
                </div>
            </div>
        </div>

        <!-- DADOS DA EMPRESA -->
        <div class="card shadow-hard mb-8 animate-slide-up">
            <div class="card-header">
                <h2 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-building text-indigo-600"></i>
                    Dados da Empresa
                </h2>
            </div>
            
            <!-- Tabs de Navega√ß√£o -->
            <div class="flex border-b mb-6">
                <button class="tab-button active" onclick="abrirTab('tab-geral')">
                    <i class="fas fa-info-circle mr-2"></i>Informa√ß√µes Gerais
                </button>
                <button class="tab-button" onclick="abrirTab('tab-financeiro')">
                    <i class="fas fa-chart-pie mr-2"></i>Dados Financeiros
                </button>
                <button class="tab-button" onclick="abrirTab('tab-parametros')">
                    <i class="fas fa-sliders-h mr-2"></i>Par√¢metros Avan√ßados
                </button>
            </div>
            
            <!-- Tab Geral -->
            <div id="tab-geral" class="tab-content active">
                <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                            <i class="fas fa-money-bill-wave mr-2"></i>Faturamento Mensal
                            <span class="tooltip-custom">
                                <span class="text-indigo-600 cursor-help ml-1">‚ÑπÔ∏è</span>
                                <span class="tooltip-text">
                                    <strong>Receita Bruta Mensal</strong><br>
                                    Valor total das vendas antes de dedu√ß√µes e impostos.<br>
                                    Base para todos os c√°lculos tribut√°rios.<br>
                                    <em>Exemplo: R$ 100.000,00</em>
                                </span>
                            </span>
                        </label>
                        <div class="relative">
                            <span class="absolute left-4 top-4 text-gray-500">R$</span>
                            <input type="number" id="faturamento" value="100000" min="0" step="1000"
                                class="w-full pl-12 pr-4 py-3.5 input-field rounded-xl text-lg font-semibold" />
                        </div>
                        <p class="text-sm text-gray-500 mt-2" id="faturamentoAnual">
                            <i class="fas fa-calendar-alt mr-1"></i>Anual: R$ 1.200.000,00
                        </p>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                            <i class="fas fa-balance-scale mr-2"></i>Regime Tribut√°rio
                            <span class="tooltip-custom">
                                <span class="text-indigo-600 cursor-help ml-1">‚ÑπÔ∏è</span>
                                <span class="tooltip-text">
                                    <strong>Sistema Tribut√°rio Atual</strong><br>
                                    ‚Ä¢ Simples: At√© R$ 4,8 milh√µes/ano<br>
                                    ‚Ä¢ Presumido: Lucro estimado por lei<br>
                                    ‚Ä¢ Real: Lucro efetivo cont√°bil<br>
                                    ‚Ä¢ Simplificado: Novo regime p√≥s-reforma
                                </span>
                            </span>
                        </label>
                        <select id="regime" class="w-full px-4 py-3.5 input-field rounded-xl text-lg">
                            <option value="simples">Simples Nacional</option>
                            <option value="presumido">Lucro Presumido</option>
                            <option value="real">Lucro Real</option>
                            <option value="simples-futuro">Novo Regime Simplificado</option>
                        </select>
                        <p class="text-sm text-gray-500 mt-2" id="regimeInfo">
                            <i class="fas fa-info-circle mr-1"></i>Limite: R$ 4,8 milh√µes/ano
                        </p>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                            <i class="fas fa-industry mr-2"></i>Setor de Atividade
                            <span class="tooltip-custom">
                                <span class="text-indigo-600 cursor-help ml-1">‚ÑπÔ∏è</span>
                                <span class="tooltip-text">
                                    <strong>Setor Econ√¥mico</strong><br>
                                    Define al√≠quotas espec√≠ficas e tratamento tribut√°rio.<br>
                                    ‚Ä¢ Com√©rcio: Al√≠quotas reduzidas<br>
                                    ‚Ä¢ Ind√∫stria: Cr√©ditos ampliados<br>
                                    ‚Ä¢ Servi√ßos: Tratamento diferenciado<br>
                                    ‚Ä¢ TI: Benef√≠cios espec√≠ficos
                                </span>
                            </span>
                        </label>
                        <select id="setor" class="w-full px-4 py-3.5 input-field rounded-xl text-lg">
                            <option value="comercio">Com√©rcio</option>
                            <option value="industria">Ind√∫stria</option>
                            <option value="servicos-gerais">Servi√ßos Gerais</option>
                            <option value="servicos-tecnologia">Servi√ßos de Tecnologia</option>
                            <option value="servicos-engenharia">Servi√ßos de Engenharia</option>
                            <option value="servicos-advocacia">Servi√ßos de Advocacia</option>
                            <option value="energia">Energia El√©trica</option>
                            <option value="telecom">Telecomunica√ß√µes</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                            <i class="fas fa-map-marker-alt mr-2"></i>Estado de Opera√ß√£o
                            <span class="tooltip-custom">
                                <span class="text-indigo-600 cursor-help ml-1">‚ÑπÔ∏è</span>
                                <span class="tooltip-text">
                                    <strong>Estado de Registro</strong><br>
                                    Afeta o ICMS atual e futura reparti√ß√£o do IBS.<br>
                                    Cada estado tem al√≠quotas e benef√≠cios diferentes.<br>
                                    <strong>Importante:</strong> IBS ser√° rateado entre estados.
                                </span>
                            </span>
                        </label>
                        <select id="estado" class="w-full px-4 py-3.5 input-field rounded-xl text-lg">
                            <option value="SP">S√£o Paulo</option>
                            <option value="RJ">Rio de Janeiro</option>
                            <option value="MG">Minas Gerais</option>
                            <option value="RS">Rio Grande do Sul</option>
                            <option value="PR">Paran√°</option>
                            <option value="SC">Santa Catarina</option>
                            <option value="BA">Bahia</option>
                            <option value="DF">Distrito Federal</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Tab Financeiro -->
            <div id="tab-financeiro" class="tab-content">
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                            <i class="fas fa-users mr-2"></i>Folha de Pagamento Mensal
                            <span class="tooltip-custom">
                                <span class="text-indigo-600 cursor-help ml-1">‚ÑπÔ∏è</span>
                                <span class="tooltip-text">
                                    <strong>Total de Sal√°rios + Encargos</strong><br>
                                    ‚Ä¢ Importante para Fator R (Simples Nacional)<br>
                                    ‚Ä¢ Base para CBS sobre folha (opcional)<br>
                                    ‚Ä¢ Considera todos os colaboradores CLT
                                </span>
                            </span>
                        </label>
                        <div class="relative">
                            <span class="absolute left-4 top-4 text-gray-500">R$</span>
                            <input type="number" id="folhaPagamento" value="30000" min="0" step="1000"
                                class="w-full pl-12 pr-4 py-3.5 input-field rounded-xl text-lg font-semibold" />
                        </div>
                        <p class="text-sm text-gray-500 mt-2" id="fatorRDisplay">
                            <i class="fas fa-percentage mr-1"></i>Fator R: 0%
                        </p>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                            <i class="fas fa-cash-register mr-2"></i>Regime de Apura√ß√£o
                            <span class="tooltip-custom">
                                <span class="text-indigo-600 cursor-help ml-1">‚ÑπÔ∏è</span>
                                <span class="tooltip-text">
                                    <strong>Momento do Cr√©dito</strong><br>
                                    ‚Ä¢ Caixa: Quando pago/recebido<br>
                                    ‚Ä¢ Compet√™ncia: Quando faturado<br>
                                    <strong>No IVA:</strong> Cr√©ditos s√≥ aproveitados quando NF √© PAGA.
                                </span>
                            </span>
                        </label>
                        <select id="regimeApuracao" class="w-full px-4 py-3.5 input-field rounded-xl text-lg">
                            <option value="caixa">Regime de Caixa</option>
                            <option value="competencia" selected>Regime de Compet√™ncia</option>
                        </select>
                        <p class="text-sm text-gray-500 mt-2">
                            <i class="fas fa-lightbulb mr-1"></i>Cr√©ditos: Caixa = quando pago | Compet√™ncia = quando faturado
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Tab Par√¢metros Avan√ßados -->
            <div id="tab-parametros" class="tab-content">
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-4">
                            <i class="fas fa-boxes mr-2"></i>Custos com Insumos
                            <span class="float-right text-indigo-600 font-bold" id="insumosValor">40%</span>
                            <span class="tooltip-custom">
                                <span class="text-indigo-600 cursor-help ml-1">‚ÑπÔ∏è</span>
                                <span class="tooltip-text">
                                    <strong>Mat√©ria-Prima e Insumos</strong><br>
                                    ‚Ä¢ Geram cr√©dito integral de IVA<br>
                                    ‚Ä¢ N√£o inclui bens do ativo imobilizado<br>
                                    ‚Ä¢ Deve ter NF-e regular<br>
                                    ‚Ä¢ Servi√ßos t√™m limite de 70% de cr√©dito
                                </span>
                            </span>
                        </label>
                        <input type="range" id="percentualInsumos" value="40" min="0" max="90" 
                            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" />
                        <div class="flex justify-between text-sm text-gray-500 mt-2">
                            <span>0%</span>
                            <span>45%</span>
                            <span>90%</span>
                        </div>
                        <div class="mt-4 p-3 rounded-lg" id="insumosAlert"></div>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-4">
                            <i class="fas fa-industry mr-2"></i>Investimento em Ativo
                            <span class="float-right text-indigo-600 font-bold" id="ativoValor">5%</span>
                            <span class="tooltip-custom">
                                <span class="text-indigo-600 cursor-help ml-1">‚ÑπÔ∏è</span>
                                <span class="tooltip-text">
                                    <strong>Ativo Imobilizado</strong><br>
                                    ‚Ä¢ M√°quinas, equipamentos, ve√≠culos<br>
                                    ‚Ä¢ Cr√©dito parcelado em 48 meses<br>
                                    ‚Ä¢ Apropria√ß√£o mensal: 1/48 do valor<br>
                                    ‚Ä¢ Incentivo para moderniza√ß√£o
                                </span>
                            </span>
                        </label>
                        <input type="range" id="percentualAtivo" value="5" min="0" max="30" 
                            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer" />
                        <div class="flex justify-between text-sm text-gray-500 mt-2">
                            <span>0%</span>
                            <span>15%</span>
                            <span>30%</span>
                        </div>
                    </div>
                </div>
                
                <div class="grid md:grid-cols-2 gap-6 mt-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                            <i class="fas fa-tags mr-2"></i>Categoria do Produto/Servi√ßo
                            <span class="tooltip-custom">
                                <span class="text-indigo-600 cursor-help ml-1">‚ÑπÔ∏è</span>
                                <span class="tooltip-text">
                                    <strong>Tratamento Tribut√°rio</strong><br>
                                    ‚Ä¢ Zero: Cesta b√°sica nacional<br>
                                    ‚Ä¢ Reduzida 60%: Sa√∫de, educa√ß√£o<br>
                                    ‚Ä¢ Reduzida 30%: Alimentos selecionados<br>
                                    ‚Ä¢ Padr√£o: Maioria dos produtos<br>
                                    ‚Ä¢ Seletivo: Produtos nocivos (+25%)
                                </span>
                            </span>
                        </label>
                        <select id="categoria" class="w-full px-4 py-3.5 input-field rounded-xl text-lg">
                            <option value="zero">Al√≠quota Zero (cesta b√°sica)</option>
                            <option value="reduzida60">Reduzida 60% (sa√∫de, educa√ß√£o)</option>
                            <option value="reduzida30">Reduzida 30% (alimentos selecionados)</option>
                            <option value="padrao" selected>Padr√£o (al√≠quota cheia)</option>
                            <option value="seletivo">Imposto Seletivo (bebidas, cigarros)</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-3">
                            <i class="fas fa-calendar mr-2"></i>Ano para Simular
                            <span class="tooltip-custom">
                                <span class="text-indigo-600 cursor-help ml-1">‚ÑπÔ∏è</span>
                                <span class="tooltip-text">
                                    <strong>Timeline da Transi√ß√£o</strong><br>
                                    ‚Ä¢ 2026: Fase teste (0,1%)<br>
                                    ‚Ä¢ 2027-28: CBS substitui PIS/COFINS<br>
                                    ‚Ä¢ 2029: IBS inicia (10%)<br>
                                    ‚Ä¢ 2033: Sistema completo (100%)
                                </span>
                            </span>
                        </label>
                        <select id="anoTransicao" class="w-full px-4 py-3.5 input-field rounded-xl text-lg">
                            <option value="2026">2026 (Teste - 0,1%)</option>
                            <option value="2027">2027 (CBS inicia)</option>
                            <option value="2029">2029 (IBS inicia)</option>
                            <option value="2032">2032 (Transi√ß√£o 90%)</option>
                            <option value="2033" selected>2033 (Sistema Completo)</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Bot√µes de A√ß√£o -->
            <div class="mt-8 pt-6 border-t border-gray-200 flex flex-wrap gap-3 justify-center">
                <button onclick="salvarSimulacao()" class="btn-primary px-6 py-3 rounded-full flex items-center gap-2">
                    <i class="fas fa-save"></i>
                    <span>Salvar Simula√ß√£o</span>
                </button>
                <button onclick="carregarSimulacoes()" class="btn-secondary px-6 py-3 rounded-full flex items-center gap-2">
                    <i class="fas fa-history"></i>
                    <span>Hist√≥rico</span>
                </button>
                <button onclick="calcularCustosAdaptacao()" class="btn-primary px-6 py-3 rounded-full flex items-center gap-2">
                    <i class="fas fa-calculator"></i>
                    <span>Custos de Adapta√ß√£o</span>
                </button>
                <button onclick="simularPrecificacao()" class="btn-primary px-6 py-3 rounded-full flex items-center gap-2">
                    <i class="fas fa-tag"></i>
                    <span>Simular Precifica√ß√£o</span>
                </button>
            </div>
        </div>

        <!-- COMPARA√á√ÉO VISUAL -->
        <div class="grid md:grid-cols-2 gap-8 mb-8">
            <!-- Sistema Atual -->
            <div class="card shadow-hard animate-slide-up">
                <div class="card-header flex items-center justify-between">
                    <h3 class="text-xl font-bold flex items-center gap-3">
                        <i class="fas fa-calendar-alt text-blue-600"></i>
                        Sistema Atual (<span id="ano-atual-label">2025</span>)
                    </h3>
                    <span class="badge badge-info">
                        <i class="fas fa-clock mr-1"></i>Vigente
                    </span>
                </div>
                
                <div class="space-y-6">
                    <div class="stat-card">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700 font-semibold">Faturamento Bruto:</span>
                            <span class="text-xl font-bold text-blue-700" id="fat-atual">R$ 100.000,00</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h4 class="font-semibold text-gray-800 mb-4">Tributos Detalhados:</h4>
                        <div class="space-y-3 mb-4" id="tributos-atual-detalhado"></div>
                        <div class="border-t pt-4">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-gray-700 font-semibold">Total de Tributos:</span>
                                <span class="text-2xl font-bold text-red-600" id="trib-atual-total">R$ 0,00</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-600">Carga Efetiva:</span>
                                <span class="font-semibold text-red-600" id="carga-atual">0%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card bg-gradient-to-r from-green-50 to-emerald-50 border-green-200">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-800 font-bold">Faturamento L√≠quido:</span>
                            <span class="text-2xl font-bold text-green-700" id="liq-atual">R$ 0,00</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Sistema Reforma -->
            <div class="card shadow-hard animate-slide-up">
                <div class="card-header flex items-center justify-between">
                    <h3 class="text-xl font-bold flex items-center gap-3">
                        <i class="fas fa-sync-alt text-purple-600"></i>
                        Ap√≥s Reforma (<span id="ano-reforma-label">2033</span>)
                    </h3>
                    <span class="badge badge-info">
                        <i class="fas fa-rocket mr-1"></i>Futuro
                    </span>
                </div>
                
                <div class="space-y-6">
                    <div class="stat-card">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700 font-semibold">Faturamento Bruto:</span>
                            <span class="text-xl font-bold text-purple-700" id="fat-reforma">R$ 100.000,00</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h4 class="font-semibold text-gray-800 mb-3">IVA Dual:</h4>
                        <div class="text-sm text-gray-600 mb-3">
                            Cen√°rio: <span id="cenario-aplicado" class="font-bold">Base (26,5%)</span>
                        </div>
                        <div class="text-sm text-gray-600 mb-4">
                            Al√≠quota efetiva: <span id="aliquotaAplicada" class="font-bold">26,5%</span>
                        </div>
                        
                        <div class="space-y-3 mb-4">
                            <div class="flex justify-between items-center py-2">
                                <span class="text-gray-700">CBS (Federal)</span>
                                <span class="font-semibold" id="cbs-valor">R$ 0,00</span>
                            </div>
                            <div class="flex justify-between items-center py-2">
                                <span class="text-gray-700">IBS (Est/Mun)</span>
                                <span class="font-semibold" id="ibs-valor">R$ 0,00</span>
                            </div>
                            <div class="flex justify-between items-center py-2" id="is-linha" style="display:none;">
                                <span class="text-gray-700">IS (Imposto Seletivo)</span>
                                <span class="font-semibold" id="is-valor">R$ 0,00</span>
                            </div>
                        </div>
                        
                        <div class="border-t pt-4">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-700 font-semibold">Tributos Brutos:</span>
                                <span class="text-xl font-bold text-red-600" id="trib-reforma-bruto">R$ 0,00</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200">
                        <h4 class="font-bold text-blue-900 mb-3 flex items-center gap-2">
                            <i class="fas fa-hand-holding-usd text-blue-600"></i>
                            Cr√©ditos IVA (N√£o-Cumulativo)
                        </h4>
                        <div class="space-y-3 text-sm">
                            <div class="flex justify-between items-center">
                                <span class="text-gray-700">Insumos (cr√©dito integral):</span>
                                <span class="font-semibold text-blue-700" id="credito-insumos">R$ 0,00</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-700">Ativo Imob. (1/48 m√™s):</span>
                                <span class="font-semibold text-blue-700" id="credito-ativo">R$ 0,00</span>
                            </div>
                            <div class="border-t pt-3 mt-3 flex justify-between items-center">
                                <span class="text-gray-700 font-bold">Total Cr√©ditos:</span>
                                <span class="font-bold text-blue-700" id="credito-total">R$ 0,00</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card bg-gradient-to-r from-orange-50 to-amber-50 border-orange-200">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-gray-700 font-semibold">Tributos L√≠quidos:</span>
                            <span class="text-xl font-bold text-orange-600" id="trib-liquido-reforma">R$ 0,00</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Carga Efetiva:</span>
                            <span class="font-semibold text-orange-600" id="carga-reforma">0%</span>
                        </div>
                    </div>
                    
                    <div class="stat-card bg-gradient-to-r from-green-50 to-emerald-50 border-green-200">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-800 font-bold">Faturamento L√≠quido:</span>
                            <span class="text-2xl font-bold text-green-700" id="liq-reforma">R$ 0,00</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- COMPARA√á√ÉO VISUAL COM ANIMA√á√ÉO -->
        <div class="card shadow-hard mb-8 animate-slide-up">
            <div class="card-header">
                <h2 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-chart-bar text-indigo-600"></i>
                    Compara√ß√£o Visual do Impacto
                </h2>
            </div>
            
            <div class="flex flex-col md:flex-row items-center justify-center gap-8 mb-8">
                <div class="text-center w-full md:w-2/5">
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-8 rounded-2xl border-2 border-blue-300">
                        <div class="text-sm text-blue-600 font-semibold mb-3">SISTEMA ATUAL</div>
                        <div class="text-4xl font-bold text-blue-700 mb-2" id="comparacao-atual">R$ 0</div>
                        <div class="text-sm text-blue-500" id="comparacao-atual-porc">0% de carga</div>
                    </div>
                </div>
                
                <div class="comparison-arrow hidden md:block">
                    <i class="fas fa-arrow-right"></i>
                </div>
                
                <div class="md:hidden my-4">
                    <i class="fas fa-arrow-down text-2xl text-indigo-500"></i>
                </div>
                
                <div class="text-center w-full md:w-2/5">
                    <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-8 rounded-2xl border-2 border-purple-300">
                        <div class="text-sm text-purple-600 font-semibold mb-3">AP√ìS REFORMA</div>
                        <div class="text-4xl font-bold text-purple-700 mb-2" id="comparacao-reforma">R$ 0</div>
                        <div class="text-sm text-purple-500" id="comparacao-reforma-porc">0% de carga</div>
                    </div>
                </div>
            </div>
            
            <div class="text-center">
                <div class="inline-block px-8 py-4 rounded-full bg-gradient-to-r from-gray-100 to-gray-200">
                    <div class="text-2xl font-bold mb-2" id="comparacao-diferenca">R$ 0</div>
                    <div>
                        <span class="badge badge-neutral" id="comparacao-badge">NEUTRO</span>
                    </div>
                </div>
                <div class="mt-4 text-gray-600" id="comparacao-descricao">
                    Sem altera√ß√£o significativa na carga tribut√°ria
                </div>
            </div>
        </div>

        <!-- NOVOS GR√ÅFICOS AVAN√áADOS -->
        <div class="card shadow-hard mb-8 animate-slide-up">
            <div class="card-header">
                <h2 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-chart-pie text-indigo-600"></i>
                    An√°lise Visual Avan√ßada
                </h2>
            </div>
            
            <!-- Tabs de Gr√°ficos -->
            <div class="flex border-b mb-6">
                <button class="tab-button active" onclick="abrirChartTab('chart-comparativo')">
                    Comparativo Geral
                </button>
                <button class="tab-button" onclick="abrirChartTab('chart-cascata')">
                    Fluxo de Cr√©ditos
                </button>
                <button class="tab-button" onclick="abrirChartTab('chart-transicao')">
                    Linha do Tempo
                </button>
                <button class="tab-button" onclick="abrirChartTab('chart-estados')">
                    An√°lise por Estado
                </button>
                <button class="tab-button" onclick="abrirChartTab('chart-setor')">
                    An√°lise por Setor
                </button>
            </div>
            
            <!-- Gr√°fico Comparativo -->
            <div id="chart-comparativo" class="tab-content active">
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-4">Comparativo de Carga Tribut√°ria</h3>
                    <p class="text-gray-600 mb-6">Este gr√°fico mostra a evolu√ß√£o da carga tribut√°ria mensal, comparando o sistema atual com o cen√°rio p√≥s-reforma. A altura das barras representa o valor absoluto em reais, enquanto as linhas horizontais indicam a carga percentual sobre o faturamento.</p>
                </div>
                <div class="chart-container">
                    <canvas id="chartComparativo"></canvas>
                </div>
            </div>
            
            <!-- Gr√°fico Cascata -->
            <div id="chart-cascata" class="tab-content">
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-4">Fluxo de C√°lculo do IVA - Gr√°fico Cascata</h3>
                    <p class="text-gray-600 mb-6">Diagrama em cascata que detalha o c√°lculo do IVA l√≠quido, mostrando como os cr√©ditos tribut√°rios reduzem a carga final. Cada etapa representa um componente do c√°lculo, desde o IVA bruto at√© os descontos por cr√©ditos de insumos e ativo imobilizado.</p>
                </div>
                <div class="chart-container">
                    <canvas id="chartCascata"></canvas>
                </div>
            </div>
            
            <!-- Gr√°fico Transi√ß√£o -->
            <div id="chart-transicao" class="tab-content">
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-4">Evolu√ß√£o da Carga Tribut√°ria (2026-2033)</h3>
                    <p class="text-gray-600 mb-6">Linha do tempo mostrando a transi√ß√£o gradual do sistema tribut√°rio atual para o IVA Dual completo. A linha azul tracejada representa o patamar atual, enquanto a linha roxa mostra a proje√ß√£o durante os anos de transi√ß√£o, com pontos de inflex√£o nos anos-chave da implementa√ß√£o.</p>
                </div>
                <div class="chart-container">
                    <canvas id="chartTransicao"></canvas>
                </div>
            </div>
            
            <!-- Gr√°fico Estados -->
            <div id="chart-estados" class="tab-content">
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-4">An√°lise Comparativa por Estado</h3>
                    <p class="text-gray-600 mb-6">Comparativo da carga tribut√°ria atual em diferentes estados da federa√ß√£o, considerando as al√≠quotas m√©dias de ICMS e benef√≠cios fiscais locais. Estados com cores mais verdes representam maior atratividade fiscal, enquanto tons de vermelho indicam cargas mais elevadas.</p>
                </div>
                <div class="chart-container">
                    <canvas id="chartEstados"></canvas>
                </div>
            </div>
            
            <!-- Gr√°fico Setor -->
            <div id="chart-setor" class="tab-content">
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-4">Impacto da Reforma por Setor Econ√¥mico</h3>
                    <p class="text-gray-600 mb-6">An√°lise setorial do impacto da reforma tribut√°ria, mostrar como diferentes atividades econ√¥micas ser√£o afetadas. Barras azuis representam o sistema atual, barras roxas o cen√°rio p√≥s-reforma, e as linhas conectam os pontos de varia√ß√£o percentual.</p>
                </div>
                <div class="chart-container">
                    <canvas id="chartSetor"></canvas>
                </div>
            </div>
        </div>

        <!-- NOVA SE√á√ÉO: Comparativo Internacional -->
        <div id="analiseInternacional" class="card shadow-hard mb-8 animate-slide-up">
            <!-- Conte√∫do gerado dinamicamente -->
        </div>

        <!-- NOVA SE√á√ÉO: Detalhamento de Custos de Implanta√ß√£o -->
        <div id="detalhamentoCustosImplantacao" class="card shadow-hard mb-8 animate-slide-up">
            <!-- Conte√∫do gerado dinamicamente -->
        </div>

        <!-- AN√ÅLISE DE PROJE√á√ÉO E CEN√ÅRIOS -->
        <div id="analiseProjecao" class="card shadow-hard mb-8 animate-slide-up">
            <!-- Conte√∫do ser√° gerado dinamicamente -->
        </div>

        <!-- AN√ÅLISE COMPARATIVA DE ESTADOS -->
        <div id="analiseEstados" class="card shadow-hard mb-8 animate-slide-up">
            <!-- Conte√∫do ser√° gerado dinamicamente -->
        </div>

        <!-- AN√ÅLISE E RECOMENDA√á√ïES -->
        <div class="card shadow-hard mb-8 animate-slide-up">
            <div class="card-header">
                <h2 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-lightbulb text-yellow-600"></i>
                    An√°lise e Recomenda√ß√µes Personalizadas
                    <span class="ml-auto text-sm font-normal text-gray-500">por Brayan Araujo Contador</span>
                </h2>
            </div>
            <div id="recomendacoes" class="space-y-6">
                <!-- Conte√∫do ser√° gerado dinamicamente -->
            </div>
        </div>

        <!-- CALCULADORA DE CUSTOS DE ADAPTA√á√ÉO -->
        <div id="custosAdaptacao" class="card shadow-hard mb-8 animate-slide-up" style="display: none;">
            <div class="card-header">
                <h2 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-calculator text-purple-600"></i>
                    Calculadora de Custos de Adapta√ß√£o √† Reforma
                </h2>
            </div>
            <!-- Conte√∫do ser√° gerado dinamicamente -->
        </div>

        <!-- TIMELINE DETALHADA -->
        <div class="card shadow-hard mb-8 animate-slide-up">
            <div class="card-header">
                <h2 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-road text-green-600"></i>
                    Timeline Detalhada da Transi√ß√£o (2026-2033)
                </h2>
            </div>
            <div id="timeline" class="space-y-6">
                <!-- Conte√∫do ser√° gerado dinamicamente -->
            </div>
        </div>

        <!-- HIST√ìRICO DE SIMULA√á√ïES -->
        <div id="historicoSimulacoes" class="card shadow-hard mb-8 animate-slide-up" style="display: none;">
            <div class="card-header">
                <h2 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-history text-blue-600"></i>
                    Hist√≥rico de Simula√ß√µes
                </h2>
            </div>
            <div id="listaSimulacoes" class="space-y-4">
                <p class="text-gray-500 text-center py-8">Nenhuma simula√ß√£o salva ainda.</p>
            </div>
        </div>

        <!-- FONTES E METODOLOGIA -->
        <div class="card shadow-soft mb-8 animate-slide-up">
            <div class="card-header">
                <h2 class="text-xl font-bold flex items-center gap-3">
                    <i class="fas fa-book text-gray-600"></i>
                    Fontes e Metodologia
                </h2>
            </div>
            <div class="text-sm text-gray-700 space-y-3">
                <p><strong>Base Legal:</strong> Emenda Constitucional 132/2023 e Projeto de Lei Complementar 68/2024</p>
                <p><strong>Estimativas T√©cnicas:</strong> Funda√ß√£o Get√∫lio Vargas (FGV), Centro de Cidadania Fiscal (CCiF), IBPT</p>
                <p><strong>Metodologia:</strong> C√°lculos simplificados para fins ilustrativos. Regime de transi√ß√£o conforme cronograma aprovado.</p>
                <p><strong>Limita√ß√µes:</strong> N√£o considera particularidades setoriais espec√≠ficas, benef√≠cios fiscais regionais, ou regimes especiais como ZFM.</p>
                <p><strong>Responsabilidade T√©cnica:</strong> Brayan Araujo Contador - CRC 1SPXXXXXX</p>
            </div>
        </div>

        <!-- RODAP√â COM CR√âDITOS -->
        <footer class="card shadow-hard animate-slide-up">
            <div class="text-center">
                <div class="logo-container inline-flex mb-6">
                    <div class="logo-icon">B</div>
                    <div class="logo-text">
                        <div class="logo-title">BRAYAN ARAUJO</div>
                        <div class="logo-subtitle">CONTADOR | ESPECIALISTA EM REFORMA TRIBUT√ÅRIA</div>
                    </div>
                </div>
                
                <h3 class="text-2xl font-bold text-gray-800 mb-3">Programa Desenvolvido por</h3>
                <p class="text-3xl font-semibold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-2">
                    Brayan Araujo Contador
                </p>
                <p class="text-gray-600 mb-6">Contador | Especialista em Tributa√ß√£o | CRC 1SPXXXXXX</p>
                
                <div class="flex flex-col md:flex-row justify-center gap-6 text-gray-600 mb-6">
                    <span><i class="fas fa-envelope mr-2"></i> brayancontabilidade@gmail.com</span>
                    <span><i class="fas fa-globe mr-2"></i> linkedin.com/in/brayanaraujo</span>
                    <span><i class="fas fa-phone mr-2"></i> (21) 99157-7383</span>
                </div>
                
                <div class="flex justify-center gap-3">
                    <button onclick="window.print()" class="btn-secondary px-4 py-2 rounded-full text-sm">
                        <i class="fas fa-print mr-2"></i>Imprimir
                    </button>
                    <button onclick="salvarComoPDF()" class="btn-primary px-4 py-2 rounded-full text-sm">
                        <i class="fas fa-file-pdf mr-2"></i>Salvar PDF
                    </button>
                    <button onclick="compartilhar()" class="btn-primary px-4 py-2 rounded-full text-sm">
                        <i class="fas fa-share-alt mr-2"></i>Compartilhar
                    </button>
                    <button onclick="abrirContatoConsultoria()" class="btn-primary px-4 py-2 rounded-full text-sm">
                        <i class="fas fa-calendar-check mr-2"></i>Consultoria
                    </button>
                </div>
                
                <p class="text-xs text-gray-400 mt-6">
                    Vers√£o 3.1 Professional - Dezembro 2024 | Comparativo Internacional e Custo de Implanta√ß√£o
                </p>
            </div>
        </footer>
    </div>

    <!-- BOT√ÉO FLUTUANTE -->
    <button class="floating-action-button" onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script>
        // ==================== CONSTANTES E CONFIGURA√á√ïES ====================
        
        const CENARIOS_IVA = {
            pessimista: {
                nome: 'Pessimista',
                aliquota: 28.0,
                cbs: 11.2,
                ibs: 16.8,
                descricao: 'Cen√°rio de compensa√ß√£o de perdas fiscais'
            },
            base: {
                nome: 'Base (Refer√™ncia)',
                aliquota: 26.5,
                cbs: 10.6,
                ibs: 15.9,
                descricao: 'Estimativa t√©cnica mais prov√°vel'
            },
            otimista: {
                nome: 'Otimista',
                aliquota: 25.0,
                cbs: 10.0,
                ibs: 15.0,
                descricao: 'Cen√°rio de efici√™ncia m√°xima'
            }
        };

        // Dados CORRIGIDOS para estados
        const INFO_ESTADOS_CORRIGIDO = {
            'SC': { 
                icms: 17.0,
                iss: 5.0,
                beneficios: ['SIMPLES Catarinense', 'Incentivos TI', 'Polo Tecnol√≥gico'],
                beneficiosDesconto: 0.10, // 10% de desconto em benef√≠cios estaduais
                score: 8.5,
                descricao: 'Menor ICMS do pa√≠s, excelente para tecnologia e inova√ß√£o'
            },
            'RS': { 
                icms: 17.0,
                iss: 5.0,
                beneficios: ['Polo Tecnol√≥gico', 'Incentivos Exporta√ß√£o', 'RS Tech'],
                beneficiosDesconto: 0.08,
                score: 8.2,
                descricao: 'ICMS competitivo, forte em exporta√ß√£o e tecnologia'
            },
            'PR': { 
                icms: 18.0,
                iss: 5.0,
                beneficios: ['ICMS 0 para software', 'REDESUL', 'Paran√° Competitivo'],
                beneficiosDesconto: 0.12,
                score: 8.7,
                descricao: 'Incentivos robustos para software, posi√ß√£o geogr√°fica estrat√©gica'
            },
            'SP': { 
                icms: 18.0,
                iss: 5.0,
                beneficios: ['Simples Paulista', 'Desconto ICMS', 'Polo Industrial'],
                beneficiosDesconto: 0.05,
                score: 8.0,
                descricao: 'Maior mercado consumidor, melhor infraestrutura, mas custos elevados'
            },
            'MG': { 
                icms: 18.0,
                iss: 5.0,
                beneficios: ['MINAS F√ÅCIL', 'Incentivos Industriais', 'MG Digital'],
                beneficiosDesconto: 0.07,
                score: 7.8,
                descricao: 'Posi√ß√£o central, incentivos industriais, custos moderados'
            },
            'RJ': { 
                icms: 20.0,
                iss: 5.0,
                beneficios: ['Porto do Rio', 'Cidade Ol√≠mpica'],
                beneficiosDesconto: 0.03,
                score: 7.2,
                descricao: 'Mercado relevante mas com maior carga tribut√°ria'
            },
            'BA': { 
                icms: 18.0,
                iss: 5.0,
                beneficios: ['PRODEB', 'Incentivos Nordeste', 'BA Inova√ß√£o'],
                beneficiosDesconto: 0.09,
                score: 7.5,
                descricao: 'Incentivos federais para Nordeste, custos operacionais baixos'
            },
            'DF': { 
                icms: 18.0,
                iss: 5.0,
                beneficios: ['Capital Federal'],
                beneficiosDesconto: 0.02,
                score: 7.0,
                descricao: 'Acesso a √≥rg√£os federais, mercado restrito'
            }
        };

        // Dados para compara√ß√£o internacional
        const COMPARACAO_INTERNACIONAL = {
            'brasil-atual': {
                nome: 'Brasil (Atual)',
                cargaTotal: 34.0,
                ivaVat: 0,
                complexidade: 9.5,
                horasAno: 1501,
                numTributos: 92,
                rankingDoingBusiness: 124,
                descricao: 'Sistema mais complexo do mundo, m√∫ltiplos impostos cumulativos'
            },
            'brasil-pos-reforma': {
                nome: 'Brasil (P√≥s-Reforma)',
                cargaTotal: 26.5,
                ivaVat: 26.5,
                complexidade: 6.0,
                horasAno: 800,
                numTributos: 3,
                rankingDoingBusiness: 80,
                descricao: 'IVA Dual, menos cumulatividade, mais simples'
            },
            'chile': {
                nome: 'Chile',
                cargaTotal: 20.2,
                ivaVat: 19.0,
                complexidade: 5.0,
                horasAno: 320,
                numTributos: 7,
                rankingDoingBusiness: 59,
                descricao: 'IVA √∫nico, sistema simples e previs√≠vel'
            },
            'mexico': {
                nome: 'M√©xico',
                cargaTotal: 16.1,
                ivaVat: 16.0,
                complexidade: 6.5,
                horasAno: 240,
                numTributos: 9,
                rankingDoingBusiness: 60,
                descricao: 'IVA federal, sistema relativamente simples'
            },
            'argentina': {
                nome: 'Argentina',
                cargaTotal: 29.0,
                ivaVat: 21.0,
                complexidade: 8.0,
                horasAno: 311,
                numTributos: 9,
                rankingDoingBusiness: 126,
                descricao: 'IVA alto, sistema complexo com muitas al√≠quotas'
            },
            'uruguai': {
                nome: 'Uruguai',
                cargaTotal: 26.8,
                ivaVat: 22.0,
                complexidade: 6.0,
                horasAno: 304,
                numTributos: 8,
                rankingDoingBusiness: 101,
                descricao: 'IVA alto, sistema mais simples que o Brasil atual'
            },
            'paraguai': {
                nome: 'Paraguai',
                cargaTotal: 14.0,
                ivaVat: 10.0,
                complexidade: 4.5,
                horasAno: 248,
                numTributos: 6,
                rankingDoingBusiness: 125,
                descricao: 'IVA mais baixo da Am√©rica Latina, sistema simples'
            },
            'colombia': {
                nome: 'Col√¥mbia',
                cargaTotal: 19.5,
                ivaVat: 19.0,
                complexidade: 6.0,
                horasAno: 317,
                numTributos: 11,
                rankingDoingBusiness: 67,
                descricao: 'IVA moderado, sistema em reforma constante'
            },
            'eua': {
                nome: 'Estados Unidos',
                cargaTotal: 27.1,
                ivaVat: 0,
                complexidade: 8.0,
                horasAno: 175,
                numTributos: 10,
                rankingDoingBusiness: 6,
                descricao: 'Sem IVA federal, sales tax por estado, sistema complexo mas eficiente'
            },
            'alemanha': {
                nome: 'Alemanha',
                cargaTotal: 39.3,
                ivaVat: 19.0,
                complexidade: 7.0,
                horasAno: 218,
                numTributos: 5,
                rankingDoingBusiness: 22,
                descricao: 'Alta carga tribut√°ria mas sistema eficiente e simplificado'
            }
        };

        // Custos de implanta√ß√£o detalhados
        const CUSTOS_IMPLANTACAO_DETALHADO = {
            'micro': {
                descricao: 'Microempresa (At√© R$ 360 mil/ano)',
                custos: {
                    consultoria: { minimo: 3000, medio: 5000, maximo: 8000 },
                    software: { minimo: 1500, medio: 2500, maximo: 4000 },
                    treinamento: { minimo: 1000, medio: 2000, maximo: 3000 },
                    documentacao: { minimo: 500, medio: 1000, maximo: 1500 },
                    totalMinimo: 6000,
                    totalMedio: 10500,
                    totalMaximo: 16500
                }
            },
            'pequena': {
                descricao: 'Pequena Empresa (R$ 360k - R$ 4,8 mi/ano)',
                custos: {
                    consultoria: { minimo: 8000, medio: 15000, maximo: 25000 },
                    software: { minimo: 3000, medio: 5000, maximo: 8000 },
                    treinamento: { minimo: 2000, medio: 4000, maximo: 6000 },
                    documentacao: { minimo: 1000, medio: 2000, maximo: 3000 },
                    totalMinimo: 14000,
                    totalMedio: 26000,
                    totalMaximo: 42000
                }
            },
            'media': {
                descricao: 'M√©dia Empresa (R$ 4,8 mi - R$ 50 mi/ano)',
                custos: {
                    consultoria: { minimo: 25000, medio: 40000, maximo: 60000 },
                    software: { minimo: 8000, medio: 15000, maximo: 25000 },
                    treinamento: { minimo: 5000, medio: 8000, maximo: 12000 },
                    documentacao: { minimo: 2000, medio: 4000, maximo: 6000 },
                    totalMinimo: 40000,
                    totalMedio: 67000,
                    totalMaximo: 103000
                }
            },
            'grande': {
                descricao: 'Grande Empresa (Acima de R$ 50 mi/ano)',
                custos: {
                    consultoria: { minimo: 60000, medio: 100000, maximo: 200000 },
                    software: { minimo: 25000, medio: 50000, maximo: 100000 },
                    treinamento: { minimo: 10000, medio: 20000, maximo: 40000 },
                    documentacao: { minimo: 5000, medio: 10000, maximo: 20000 },
                    totalMinimo: 100000,
                    totalMedio: 180000,
                    totalMaximo: 360000
                }
            }
        };

        const MARGEM_PRESUMIDA = {
            'comercio': 8,
            'industria': 8,
            'servicos-gerais': 32,
            'servicos-tecnologia': 32,
            'servicos-engenharia': 16,
            'servicos-advocacia': 32,
            'energia': 8,
            'telecom': 8
        };

        const LIMITE_CREDITO_SERVICOS = 0.7;

        const CATEGORIAS_ALIQUOTA = {
            zero: { 
                nome: 'Al√≠quota Zero', 
                fator: 0.0,
                descricao: 'Cesta b√°sica nacional (arroz, feij√£o, leite, etc.)'
            },
            reduzida60: { 
                nome: 'Reduzida 60%', 
                fator: 0.4,
                descricao: 'Servi√ßos de sa√∫de, educa√ß√£o, transporte p√∫blico'
            },
            reduzida30: { 
                nome: 'Reduzida 30%', 
                fator: 0.7,
                descricao: 'Alimentos processados, produtos de higiene pessoal'
            },
            padrao: { 
                nome: 'Padr√£o', 
                fator: 1.0,
                descricao: 'Maioria dos produtos e servi√ßos (al√≠quota cheia)'
            },
            seletivo: { 
                nome: 'Imposto Seletivo', 
                fator: 1.0,
                impostoSeletivo: 0.25,
                descricao: 'Bebidas alco√≥licas, cigarros, armas (adicional de 25%)'
            }
        };

        const TRANSICAO_DETALHADA = {
            2026: { cbs: 0.001, ibs: 0.001, sistemaAntigo: 0.998, descricao: 'Fase experimental' },
            2027: { cbs: 1.0, ibs: 0.001, sistemaAntigo: 0, descricao: 'CBS substitui PIS/COFINS' },
            2028: { cbs: 1.0, ibs: 0.001, sistemaAntigo: 0, descricao: 'Consolida√ß√£o do CBS' },
            2029: { cbs: 1.0, ibs: 0.1, sistemaAntigo: 0, descricao: 'IBS inicia substitui√ß√£o' },
            2030: { cbs: 1.0, ibs: 0.3, sistemaAntigo: 0, descricao: 'IBS a 30%' },
            2031: { cbs: 1.0, ibs: 0.6, sistemaAntigo: 0, descricao: 'IBS a 60%' },
            2032: { cbs: 1.0, ibs: 0.9, sistemaAntigo: 0, descricao: 'IBS a 90%' },
            2033: { cbs: 1.0, ibs: 1.0, sistemaAntigo: 0, descricao: 'Sistema completo' }
        };

        const SIMPLES_ALIQUOTAS = {
            comercio: [
                { limite: 180000, aliquota: 4.0, deducao: 0 },
                { limite: 360000, aliquota: 7.3, deducao: 5940 },
                { limite: 720000, aliquota: 9.5, deducao: 13860 },
                { limite: 1800000, aliquota: 10.7, deducao: 22500 },
                { limite: 3600000, aliquota: 14.3, deducao: 87300 },
                { limite: 4800000, aliquota: 19.0, deducao: 378000 }
            ],
            industria: [
                { limite: 180000, aliquota: 4.5, deducao: 0 },
                { limite: 360000, aliquota: 7.8, deducao: 5940 },
                { limite: 720000, aliquota: 10.0, deducao: 13860 },
                { limite: 1800000, aliquota: 11.2, deducao: 22500 },
                { limite: 3600000, aliquota: 14.7, deducao: 85500 },
                { limite: 4800000, aliquota: 30.0, deducao: 720000 }
            ],
            'servicos-gerais': [
                { limite: 180000, aliquota: 6.0, deducao: 0 },
                { limite: 360000, aliquota: 11.2, deducao: 9360 },
                { limite: 720000, aliquota: 13.5, deducao: 17640 },
                { limite: 1800000, aliquota: 16.0, deducao: 35640 },
                { limite: 3600000, aliquota: 21.0, deducao: 125640 },
                { limite: 4800000, aliquota: 33.0, deducao: 648000 }
            ],
            'servicos-tecnologia': [
                { limite: 180000, aliquota: 6.0, deducao: 0 },
                { limite: 360000, aliquota: 11.2, deducao: 9360 },
                { limite: 720000, aliquota: 13.5, deducao: 17640 },
                { limite: 1800000, aliquota: 16.0, deducao: 35640 },
                { limite: 3600000, aliquota: 21.0, deducao: 125640 },
                { limite: 4800000, aliquota: 33.0, deducao: 648000 }
            ],
            'servicos-engenharia': [
                { limite: 180000, aliquota: 6.0, deducao: 0 },
                { limite: 360000, aliquota: 11.2, deducao: 9360 },
                { limite: 720000, aliquota: 13.5, deducao: 17640 },
                { limite: 1800000, aliquota: 16.0, deducao: 35640 },
                { limite: 3600000, aliquota: 21.0, deducao: 125640 },
                { limite: 4800000, aliquota: 33.0, deducao: 648000 }
            ],
            'servicos-advocacia': [
                { limite: 180000, aliquota: 15.5, deducao: 0 },
                { limite: 360000, aliquota: 18.0, deducao: 4500 },
                { limite: 720000, aliquota: 19.5, deducao: 9900 },
                { limite: 1800000, aliquota: 20.5, deducao: 17100 },
                { limite: 3600000, aliquota: 23.0, deducao: 62100 },
                { limite: 4800000, aliquota: 30.5, deducao: 540000 }
            ],
            'energia': [
                { limite: 180000, aliquota: 4.0, deducao: 0 },
                { limite: 360000, aliquota: 7.3, deducao: 5940 },
                { limite: 720000, aliquota: 9.5, deducao: 13860 },
                { limite: 1800000, aliquota: 10.7, deducao: 22500 },
                { limite: 3600000, aliquota: 14.3, deducao: 87300 },
                { limite: 4800000, aliquota: 19.0, deducao: 378000 }
            ],
            'telecom': [
                { limite: 180000, aliquota: 4.0, deducao: 0 },
                { limite: 360000, aliquota: 7.3, deducao: 5940 },
                { limite: 720000, aliquota: 9.5, deducao: 13860 },
                { limite: 1800000, aliquota: 10.7, deducao: 22500 },
                { limite: 3600000, aliquota: 14.3, deducao: 87300 },
                { limite: 4800000, aliquota: 19.0, deducao: 378000 }
            ]
        };

        // Vari√°veis globais
        let cenarioAtual = 'base';
        let historicoSimulacoes = JSON.parse(localStorage.getItem('historicoSimulacoes')) || [];
        let charts = {};

        // ==================== FUN√á√ïES DE UTILIDADE ====================
        
        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(valor);
        }

        function formatarPorcentagem(valor, casas = 2) {
            return valor.toFixed(casas) + '%';
        }

        function abrirTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            document.getElementById(tabId).classList.add('active');
            
            document.querySelector(`button[onclick="abrirTab('${tabId}')"]`).classList.add('active');
        }

        function abrirChartTab(chartTabId) {
            document.querySelectorAll('#chart-comparativo, #chart-cascata, #chart-transicao, #chart-estados, #chart-setor').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            document.getElementById(chartTabId).classList.add('active');
            
            document.querySelector(`button[onclick="abrirChartTab('${chartTabId}')"]`).classList.add('active');
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ==================== FUN√á√ïES DE C√ÅLCULO CORRIGIDAS ====================
        
        function calcularFatorR(folha, faturamento) {
            if (faturamento === 0) return 0;
            return (folha / faturamento) * 100;
        }

        function calcularSimplesNacional(faturamentoAnual, setor, fatorR) {
            if (faturamentoAnual > 4800000) {
                return { 
                    aliquota: 0, 
                    erro: 'Faturamento excede limite do Simples (R$ 4,8 mi/ano)' 
                };
            }

            let setorCalculo = setor;
            if (setor.includes('servicos')) {
                if (setor === 'servicos-advocacia') {
                    setorCalculo = 'servicos-advocacia';
                } else {
                    setorCalculo = fatorR >= 28 ? setor : 'servicos-advocacia';
                }
            }

            const tabela = SIMPLES_ALIQUOTAS[setorCalculo] || SIMPLES_ALIQUOTAS['servicos-gerais'];
            let faixa = tabela[tabela.length - 1];
            
            for (let i = 0; i < tabela.length; i++) {
                if (faturamentoAnual <= tabela[i].limite) {
                    faixa = tabela[i];
                    break;
                }
            }
            
            const aliquotaEfetiva = ((faturamentoAnual * faixa.aliquota / 100) - faixa.deducao) / faturamentoAnual * 100;
            return { 
                aliquota: Math.max(aliquotaEfetiva, 0),
                anexo: setorCalculo,
                fatorR: fatorR
            };
        }

        function calcularRegimeSimplificado(faturamento) {
            const aliquotaSimplificada = 0.10;
            const tributo = faturamento * aliquotaSimplificada;
            
            return {
                total: tributo,
                detalhes: [{ 
                    nome: `Novo Regime Simplificado (10%)`, 
                    valor: tributo 
                }],
                aliquotaEfetiva: 10.0
            };
        }

        // FUN√á√ÉO CORRIGIDA: Calcular sistema atual por estado
        function calcularSistemaAtualCorrigido(dados, estadoAlvo = null) {
            const estado = estadoAlvo || dados.estado;
            const estadoInfo = INFO_ESTADOS_CORRIGIDO[estado] || INFO_ESTADOS_CORRIGIDO['SP'];
            
            if (dados.regime === 'simples-futuro') {
                return calcularRegimeSimplificado(dados.faturamento);
            }
            
            if (dados.regime === 'simples') {
                const faturamentoAnual = dados.faturamento * 12;
                const folhaAnual = dados.folhaPagamento * 12;
                const fatorR = calcularFatorR(folhaAnual, faturamentoAnual);
                
                const resultado = calcularSimplesNacional(faturamentoAnual, dados.setor, fatorR);
                if (resultado.erro) {
                    return {
                        total: 0,
                        detalhes: [{ nome: 'ERRO', valor: 0 }],
                        erro: resultado.erro
                    };
                }
                
                let tributoTotal = dados.faturamento * (resultado.aliquota / 100);
                
                // Aplicar benef√≠cios estaduais para Simples
                if (estadoInfo.beneficiosDesconto) {
                    const desconto = tributoTotal * estadoInfo.beneficiosDesconto;
                    tributoTotal -= desconto;
                    
                    return {
                        total: tributoTotal,
                        detalhes: [
                            { 
                                nome: `Simples Nacional (Anexo: ${resultado.anexo})`, 
                                valor: dados.faturamento * (resultado.aliquota / 100) 
                            },
                            { 
                                nome: `Desconto Estadual ${(estadoInfo.beneficiosDesconto * 100)}%`, 
                                valor: -desconto 
                            }
                        ],
                        aliquotaEfetiva: (tributoTotal / dados.faturamento) * 100
                    };
                }
                
                return {
                    total: tributoTotal,
                    detalhes: [{ 
                        nome: `Simples Nacional (Anexo: ${resultado.anexo}, Fator R: ${fatorR.toFixed(1)}%)`, 
                        valor: tributoTotal 
                    }],
                    aliquotaEfetiva: resultado.aliquota
                };
            }
            
            // Para Lucro Presumido e Real - CORRIGIDO
            const margem = MARGEM_PRESUMIDA[dados.setor] || 32;
            const lucroPresumido = dados.faturamento * (margem / 100);
            
            let irpj = lucroPresumido * 0.15;
            if (lucroPresumido > 20000) {
                irpj += (lucroPresumido - 20000) * 0.10;
            }
            
            const csll = lucroPresumido * 0.09;
            const pis = dados.faturamento * 0.0065;
            const cofins = dados.faturamento * 0.03;
            
            let icmsIss = 0;
            // CORRE√á√ÉO: Servi√ßos pagam ISS, outros pagam ICMS
            if (dados.setor.includes('servicos')) {
                // Servi√ßos pagam ISS (municipal)
                icmsIss = dados.faturamento * (estadoInfo.iss / 100);
            } else {
                // Com√©rcio e ind√∫stria pagam ICMS (estadual)
                icmsIss = dados.faturamento * (estadoInfo.icms / 100);
            }
            
            const total = irpj + csll + pis + cofins + icmsIss;
            
            // Aplicar benef√≠cios estaduais
            let descontoBeneficios = 0;
            if (estadoInfo.beneficiosDesconto) {
                descontoBeneficios = total * estadoInfo.beneficiosDesconto;
            }
            
            const totalFinal = total - descontoBeneficios;
            
            return {
                total: totalFinal,
                detalhes: [
                    { nome: 'IRPJ', valor: irpj },
                    { nome: 'CSLL', valor: csll },
                    { nome: 'PIS', valor: pis },
                    { nome: 'COFINS', valor: cofins },
                    { 
                        nome: dados.setor.includes('servicos') ? 'ISS' : 'ICMS', 
                        valor: icmsIss 
                    },
                    ...(descontoBeneficios > 0 ? [
                        { 
                            nome: `Desconto Estadual ${(estadoInfo.beneficiosDesconto * 100)}%`, 
                            valor: -descontoBeneficios 
                        }
                    ] : [])
                ],
                aliquotaEfetiva: (totalFinal / dados.faturamento) * 100
            };
        }

        function calcularLucroReal(faturamento, setor, estado, margemLucro = 15) {
            const lucroReal = faturamento * (margemLucro / 100);
            
            let irpj = lucroReal * 0.15;
            if (lucroReal > 20000) {
                irpj += (lucroReal - 20000) * 0.10;
            }
            
            const csll = lucroReal * 0.09;
            const pis = faturamento * 0.0165;
            const cofins = faturamento * 0.076;
            
            const estadoInfo = INFO_ESTADOS_CORRIGIDO[estado] || INFO_ESTADOS_CORRIGIDO['SP'];
            let icmsIss = 0;
            if (setor.includes('servicos')) {
                icmsIss = faturamento * (estadoInfo.iss / 100);
            } else {
                icmsIss = faturamento * (estadoInfo.icms / 100);
            }
            
            return {
                irpj,
                csll,
                pis,
                cofins,
                icmsIss,
                total: irpj + csll + pis + cofins + icmsIss,
                detalhes: [
                    { nome: 'IRPJ', valor: irpj },
                    { nome: 'CSLL', valor: csll },
                    { nome: 'PIS (NC)', valor: pis },
                    { nome: 'COFINS (NC)', valor: cofins },
                    { nome: setor.includes('servicos') ? 'ISS' : 'ICMS', valor: icmsIss }
                ]
            };
        }

        function calcularIVADual(dados) {
            const cenario = CENARIOS_IVA[cenarioAtual];
            const categoria = CATEGORIAS_ALIQUOTA[dados.categoria];
            const faturamento = dados.faturamento;
            
            let aliquotaAjustada = cenario.aliquota;
            if (dados.setor === 'energia') {
                aliquotaAjustada = 14.0;
            } else if (dados.setor === 'telecom') {
                aliquotaAjustada = 22.0;
            }
            
            const cbsAplicada = (aliquotaAjustada * 0.4) * categoria.fator;
            const ibsAplicada = (aliquotaAjustada * 0.6) * categoria.fator;
            const aliquotaTotal = (cbsAplicada + ibsAplicada);
            
            const cbsBruto = faturamento * (cbsAplicada / 100);
            const ibsBruto = faturamento * (ibsAplicada / 100);
            let ivaBruto = cbsBruto + ibsBruto;
            
            let impostoSeletivo = 0;
            if (categoria.impostoSeletivo) {
                impostoSeletivo = faturamento * categoria.impostoSeletivo;
                ivaBruto += impostoSeletivo;
            }
            
            const valorInsumos = faturamento * (dados.percentualInsumos / 100);
            let creditoInsumos = valorInsumos * (aliquotaTotal / 100);
            
            if (dados.setor.includes('servicos') && dados.setor !== 'energia' && dados.setor !== 'telecom') {
                creditoInsumos = creditoInsumos * LIMITE_CREDITO_SERVICOS;
            }
            
            const valorAtivo = faturamento * (dados.percentualAtivo / 100);
            const creditoAtivoTotal = valorAtivo * (aliquotaTotal / 100);
            const creditoAtivoMensal = creditoAtivoTotal / 48;
            
            const creditoTotal = creditoInsumos + creditoAtivoMensal;
            const ivaLiquido = Math.max(0, ivaBruto - creditoTotal);
            
            return {
                cenario: cenario.nome,
                aliquotaTotal,
                cbsAplicada,
                ibsAplicada,
                cbsBruto,
                ibsBruto,
                impostoSeletivo,
                ivaBruto,
                valorInsumos,
                creditoInsumos,
                valorAtivo,
                creditoAtivoMensal,
                creditoAtivoTotal,
                creditoTotal,
                ivaLiquido
            };
        }

        function calcularTransicao(dados, ano) {
            const transicao = TRANSICAO_DETALHADA[ano];
            const sistemaAtual = calcularSistemaAtualCorrigido(dados);
            const reforma = calcularIVADual(dados);
            
            let tributoAtualAjustado = sistemaAtual.total;
            if (ano >= 2027) {
                const pisCofinsMedio = dados.faturamento * 0.0365;
                tributoAtualAjustado = Math.max(0, sistemaAtual.total - pisCofinsMedio);
            }
            
            const cbsParcial = reforma.cbsBruto * transicao.cbs;
            const ibsParcial = (reforma.ibsBruto + reforma.impostoSeletivo) * transicao.ibs;
            const sistemaAntigoParcial = tributoAtualAjustado * transicao.sistemaAntigo;
            
            const creditoParcial = reforma.creditoTotal * Math.max(transicao.cbs, transicao.ibs);
            
            const tributoTotal = cbsParcial + ibsParcial + sistemaAntigoParcial - creditoParcial;
            
            return {
                tributoTotal: Math.max(0, tributoTotal),
                cbsParcial,
                ibsParcial,
                sistemaAntigoParcial,
                creditoParcial,
                transicao
            };
        }

        // ==================== NOVAS FUN√á√ïES PARA COMPARATIVO INTERNACIONAL ====================
        
        function gerarAnaliseInternacional(dados, sistemaAtual, tributoReforma) {
            const cargaAtual = (sistemaAtual.total / dados.faturamento) * 100;
            const cargaReforma = (tributoReforma / dados.faturamento) * 100;
            
            let html = `
                <div class="card-header">
                    <h3 class="text-2xl font-bold flex items-center gap-3">
                        <i class="fas fa-globe-americas text-indigo-600"></i>
                        Comparativo Internacional de Carga Tribut√°ria
                    </h3>
                </div>
                
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-4">Posicionamento Global do Brasil</h3>
                    <p class="text-gray-600 mb-6">
                        Compare a carga tribut√°ria brasileira (atual e p√≥s-reforma) com outros pa√≠ses.
                        Dados em % do PIB em tributos sobre empresas.
                    </p>
                </div>
                
                <div class="chart-container">
                    <canvas id="chartInternacional"></canvas>
                </div>
                
                <div class="mt-8 grid md:grid-cols-3 gap-6">
            `;
            
            // Pa√≠ses mais relevantes para compara√ß√£o
            const paisesRelevantes = [
                'brasil-atual',
                'brasil-pos-reforma', 
                'chile',
                'argentina',
                'paraguai',
                'alemanha'
            ];
            
            paisesRelevantes.forEach(paisKey => {
                const pais = COMPARACAO_INTERNACIONAL[paisKey];
                const diferenca = pais.cargaTotal - cargaReforma;
                
                html += `
                    <div class="card ${paisKey.includes('brasil') ? 'border-2 border-indigo-500' : ''}">
                        <div class="text-center">
                            <div class="text-sm font-semibold text-gray-700 mb-2">${pais.nome}</div>
                            <div class="text-3xl font-bold ${pais.cargaTotal < cargaReforma ? 'text-green-600' : 'text-red-600'} mb-2">
                                ${pais.cargaTotal}%
                            </div>
                            <div class="text-sm text-gray-600 mb-3">Carga Tribut√°ria Total</div>
                            
                            <div class="space-y-2 text-left">
                                <div class="flex justify-between">
                                    <span class="text-gray-600 text-sm">IVA/VAT:</span>
                                    <span class="font-medium">${pais.ivaVat > 0 ? pais.ivaVat + '%' : 'N√£o tem'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600 text-sm">Complexidade:</span>
                                    <span class="font-medium">${pais.complexidade}/10</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600 text-sm">Horas/ano:</span>
                                    <span class="font-medium">${pais.horasAno}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600 text-sm">Ranking DB:</span>
                                    <span class="font-medium">${pais.rankingDoingBusiness}¬∫</span>
                                </div>
                            </div>
                            
                            <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                                <div class="text-sm ${diferenca < 0 ? 'text-green-600' : 'text-red-600'} font-medium">
                                    ${diferenca < 0 ? 'Melhor que Brasil p√≥s-reforma' : 'Pior que Brasil p√≥s-reforma'}
                                    ${diferenca !== 0 ? `(${Math.abs(diferenca).toFixed(1)}%)` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += `
                </div>
                
                <div class="mt-8 card bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200">
                    <h4 class="font-bold text-blue-900 mb-4 flex items-center gap-2">
                        <i class="fas fa-chart-line text-blue-600"></i>
                        An√°lise Comparativa por Brayan Araujo Contador
                    </h4>
                    
                    <div class="space-y-3 text-sm">
                        <p><strong>Conclus√µes Importantes:</strong></p>
                        <ul class="list-disc pl-5 space-y-1">
                            <li>O Brasil atual tem o sistema tribut√°rio mais complexo do mundo (9.5/10)</li>
                            <li>Ap√≥s a reforma, cairemos para complexidade m√©dia (6.0/10)</li>
                            <li>A carga tribut√°ria brasileira (${cargaReforma.toFixed(1)}%) ser√° maior que a m√©dia latino-americana (18-22%)</li>
                            <li>Pa√≠ses como Paraguai (10% IVA) e Chile (19% IVA) ser√£o mais competitivos</li>
                            <li>A reforma reduzir√° de 1.501 para ~800 horas/ano de compliance tribut√°rio</li>
                        </ul>
                        <p class="mt-3"><strong>Recomenda√ß√£o Estrat√©gica:</strong> Mesmo com a reforma, empresas brasileiras ainda ter√£o desvantagem competitiva frente a concorrentes de outros pa√≠ses da regi√£o. Considere estrat√©gias de efici√™ncia tribut√°ria adicional.</p>
                    </div>
                </div>
            `;
            
            return html;
        }

        // ==================== FUN√á√ïES PARA DETALHAMENTO DE CUSTOS ====================
        
        function gerarDetalhamentoCustosImplantacao(dados) {
            const faturamentoAnual = dados.faturamento * 12;
            let porte = 'micro';
            
            if (faturamentoAnual <= 360000) {
                porte = 'micro';
            } else if (faturamentoAnual <= 4800000) {
                porte = 'pequena';
            } else if (faturamentoAnual <= 50000000) {
                porte = 'media';
            } else {
                porte = 'grande';
            }
            
            const custosPorte = CUSTOS_IMPLANTACAO_DETALHADO[porte];
            
            // Calcular economia esperada
            const sistemaAtual = calcularSistemaAtualCorrigido(dados);
            const reforma = calcularIVADual(dados);
            const economiaMensal = sistemaAtual.total - reforma.ivaLiquido;
            const economiaAnual = economiaMensal * 12;
            
            // Calcular ROI
            const custoMedio = custosPorte.custos.totalMedio;
            const mesesPayback = custoMedio / economiaMensal;
            const roiAnual = (economiaAnual / custoMedio) * 100;
            
            let html = `
                <div class="card-header">
                    <h3 class="text-2xl font-bold flex items-center gap-3">
                        <i class="fas fa-calculator text-purple-600"></i>
                        Detalhamento de Custos para Implanta√ß√£o da Melhoria Tribut√°ria
                    </h3>
                    <p class="text-gray-600 mt-2 text-sm">
                        An√°lise completa de investimento necess√°rio para adapta√ß√£o √† reforma tribut√°ria
                    </p>
                </div>
                
                <div class="space-y-8">
                    <div class="grid md:grid-cols-4 gap-6">
                        <div class="card text-center">
                            <div class="text-sm text-gray-600 mb-2">Porte da Empresa</div>
                            <div class="text-2xl font-bold text-indigo-600">${custosPorte.descricao}</div>
                            <div class="text-sm text-gray-500 mt-2">Faturamento anual: ${formatarMoeda(faturamentoAnual)}</div>
                        </div>
                        
                        <div class="card text-center">
                            <div class="text-sm text-gray-600 mb-2">Custo Total M√©dio</div>
                            <div class="text-2xl font-bold text-purple-600">${formatarMoeda(custoMedio)}</div>
                            <div class="text-sm text-gray-500 mt-2">
                                Min: ${formatarMoeda(custosPorte.custos.totalMinimo)} | 
                                Max: ${formatarMoeda(custosPorte.custos.totalMaximo)}
                            </div>
                        </div>
                        
                        <div class="card text-center">
                            <div class="text-sm text-gray-600 mb-2">Payback Estimado</div>
                            <div class="text-2xl font-bold ${mesesPayback <= 12 ? 'text-green-600' : 'text-yellow-600'}">
                                ${mesesPayback.toFixed(1)} meses
                            </div>
                            <div class="text-sm text-gray-500 mt-2">Tempo para retorno do investimento</div>
                        </div>
                        
                        <div class="card text-center">
                            <div class="text-sm text-gray-600 mb-2">ROI Anual</div>
                            <div class="text-2xl font-bold ${roiAnual > 100 ? 'text-green-600' : roiAnual > 50 ? 'text-yellow-600' : 'text-red-600'}">
                                ${roiAnual.toFixed(0)}%
                            </div>
                            <div class="text-sm text-gray-500 mt-2">Retorno sobre o investimento</div>
                        </div>
                    </div>
                    
                    <!-- Detalhamento dos Custos -->
                    <div>
                        <h4 class="text-lg font-semibold mb-4 flex items-center gap-2">
                            <i class="fas fa-list-alt text-blue-600"></i>
                            Composi√ß√£o Detalhada dos Custos
                        </h4>
                        
                        <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <div class="card">
                                <div class="text-center">
                                    <div class="text-sm text-gray-600 mb-2">Consultoria Especializada</div>
                                    <div class="text-2xl font-bold text-blue-600 mb-2">
                                        ${formatarMoeda(custosPorte.custos.consultoria.medio)}
                                    </div>
                                    <div class="text-xs text-gray-500 mb-4">
                                        Planejamento e implementa√ß√£o
                                    </div>
                                    <div class="space-y-1">
                                        <div class="flex justify-between text-sm">
                                            <span>An√°lise inicial:</span>
                                            <span>${formatarMoeda(custosPorte.custos.consultoria.medio * 0.3)}</span>
                                        </div>
                                        <div class="flex justify-between text-sm">
                                            <span>Planejamento:</span>
                                            <span>${formatarMoeda(custosPorte.custos.consultoria.medio * 0.4)}</span>
                                        </div>
                                        <div class="flex justify-between text-sm">
                                            <span>Acompanhamento:</span>
                                            <span>${formatarMoeda(custosPorte.custos.consultoria.medio * 0.3)}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="text-center">
                                    <div class="text-sm text-gray-600 mb-2">Software/ERP</div>
                                    <div class="text-2xl font-bold text-green-600 mb-2">
                                        ${formatarMoeda(custosPorte.custos.software.medio)}
                                    </div>
                                    <div class="text-xs text-gray-500 mb-4">
                                        Sistema compat√≠vel com IVA Dual
                                    </div>
                                    <div class="space-y-1">
                                        <div class="flex justify-between text-sm">
                                            <span>Licen√ßa anual:</span>
                                            <span>${formatarMoeda(custosPorte.custos.software.medio * 0.7)}</span>
                                        </div>
                                        <div class="flex justify-between text-sm">
                                            <span>Implanta√ß√£o:</span>
                                            <span>${formatarMoeda(custosPorte.custos.software.medio * 0.3)}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="text-center">
                                    <div class="text-sm text-gray-600 mb-2">Treinamento da Equipe</div>
                                    <div class="text-2xl font-bold text-yellow-600 mb-2">
                                        ${formatarMoeda(custosPorte.custos.treinamento.medio)}
                                    </div>
                                    <div class="text-xs text-gray-500 mb-4">
                                        Capacita√ß√£o para nova tributa√ß√£o
                                    </div>
                                    <div class="space-y-1">
                                        <div class="flex justify-between text-sm">
                                            <span>Gestores:</span>
                                            <span>${formatarMoeda(custosPorte.custos.treinamento.medio * 0.4)}</span>
                                        </div>
                                        <div class="flex justify-between text-sm">
                                            <span>Operacional:</span>
                                            <span>${formatarMoeda(custosPorte.custos.treinamento.medio * 0.6)}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="text-center">
                                    <div class="text-sm text-gray-600 mb-2">Documenta√ß√£o/Regulamentos</div>
                                    <div class="text-2xl font-bold text-red-600 mb-2">
                                        ${formatarMoeda(custosPorte.custos.documentacao.medio)}
                                    </div>
                                    <div class="text-xs text-gray-500 mb-4">
                                        Adequa√ß√£o de processos e documentos
                                    </div>
                                    <div class="space-y-1">
                                        <div class="flex justify-between text-sm">
                                            <span>Manuais:</span>
                                            <span>${formatarMoeda(custosPorte.custos.documentacao.medio * 0.5)}</span>
                                        </div>
                                        <div class="flex justify-between text-sm">
                                            <span>Certifica√ß√µes:</span>
                                            <span>${formatarMoeda(custosPorte.custos.documentacao.medio * 0.5)}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Timeline de Implanta√ß√£o -->
                    <div>
                        <h4 class="text-lg font-semibold mb-4 flex items-center gap-2">
                            <i class="fas fa-calendar-alt text-indigo-600"></i>
                            Timeline de Implanta√ß√£o (6 meses)
                        </h4>
                        
                        <div class="implementation-timeline">
                            <div class="timeline-phase phase-1">
                                <div class="flex justify-between items-start mb-3">
                                    <h5 class="font-bold text-lg">M√™s 1-2: Diagn√≥stico e Planejamento</h5>
                                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-medium">${formatarMoeda(custoMedio * 0.3)}</span>
                                </div>
                                <ul class="list-disc pl-5 space-y-2 text-sm text-gray-700">
                                    <li>An√°lise completa da situa√ß√£o atual</li>
                                    <li>Mapeamento de processos tribut√°rios</li>
                                    <li>Planejamento estrat√©gico de adapta√ß√£o</li>
                                    <li>Sele√ß√£o de fornecedores (software/consultoria)</li>
                                </ul>
                            </div>
                            
                            <div class="timeline-phase phase-2">
                                <div class="flex justify-between items-start mb-3">
                                    <h5 class="font-bold text-lg">M√™s 3-4: Implementa√ß√£o T√©cnica</h5>
                                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">${formatarMoeda(custoMedio * 0.4)}</span>
                                </div>
                                <ul class="list-disc pl-5 space-y-2 text-sm text-gray-700">
                                    <li>Implanta√ß√£o do sistema ERP/software</li>
                                    <li>Configura√ß√£o de par√¢metros tribut√°rios</li>
                                    <li>Adequa√ß√£o de processos cont√°beis</li>
                                    <li>Integra√ß√£o com sistemas existentes</li>
                                </ul>
                            </div>
                            
                            <div class="timeline-phase phase-3">
                                <div class="flex justify-between items-start mb-3">
                                    <h5 class="font-bold text-lg">M√™s 5: Capacita√ß√£o e Treinamento</h5>
                                    <span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium">${formatarMoeda(custoMedio * 0.2)}</span>
                                </div>
                                <ul class="list-disc pl-5 space-y-2 text-sm text-gray-700">
                                    <li>Treinamento da equipe cont√°bil</li>
                                    <li>Capacita√ß√£o de gestores</li>
                                    <li>Workshops setoriais</li>
                                    <li>Elabora√ß√£o de manuais e procedimentos</li>
                                </ul>
                            </div>
                            
                            <div class="timeline-phase phase-4">
                                <div class="flex justify-between items-start mb-3">
                                    <h5 class="font-bold text-lg">M√™s 6: Testes e Ajustes Finais</h5>
                                    <span class="bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full text-sm font-medium">${formatarMoeda(custoMedio * 0.1)}</span>
                                </div>
                                <ul class="list-disc pl-5 space-y-2 text-sm text-gray-700">
                                    <li>Testes de valida√ß√£o do sistema</li>
                                    <li>Ajustes finais nos processos</li>
                                    <li>Auditoria de conformidade</li>
                                    <li>Plano de conting√™ncia</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- An√°lise de Retorno Financeiro -->
                    <div class="card bg-gradient-to-r from-green-50 to-emerald-50 border-green-200">
                        <h4 class="font-bold text-green-900 mb-4 flex items-center gap-2">
                            <i class="fas fa-chart-line text-green-600"></i>
                            An√°lise de Retorno Financeiro (ROI)
                        </h4>
                        
                        <div class="grid md:grid-cols-3 gap-6">
                            <div class="text-center">
                                <div class="text-sm text-gray-600 mb-2">Economia Anual Estimada</div>
                                <div class="text-3xl font-bold text-green-600">
                                    ${formatarMoeda(economiaAnual)}
                                </div>
                                <div class="text-xs text-gray-500 mt-1">
                                    ${formatarMoeda(economiaMensal)}/m√™s
                                </div>
                            </div>
                            
                            <div class="text-center">
                                <div class="text-sm text-gray-600 mb-2">Investimento Total</div>
                                <div class="text-3xl font-bold text-purple-600">
                                    ${formatarMoeda(custoMedio)}
                                </div>
                                <div class="text-xs text-gray-500 mt-1">
                                    Pago em ${mesesPayback.toFixed(1)} meses
                                </div>
                            </div>
                            
                            <div class="text-center">
                                <div class="text-sm text-gray-600 mb-2">ROI em 3 Anos</div>
                                <div class="text-3xl font-bold ${(roiAnual * 3) > 100 ? 'text-green-600' : 'text-yellow-600'}">
                                    ${(roiAnual * 3).toFixed(0)}%
                                </div>
                                <div class="text-xs text-gray-500 mt-1">
                                    Retorno sobre investimento
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-6">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-sm font-medium text-gray-700">Payback Progressivo</span>
                                <span class="text-sm font-bold ${mesesPayback <= 12 ? 'text-green-600' : 'text-yellow-600'}">
                                    ${mesesPayback <= 12 ? 'RETORNO R√ÅPIDO' : 'RETORNO MODERADO'}
                                </span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-green-600 h-3 rounded-full" style="width: ${Math.min(100, (economiaMensal * 6) / custoMedio * 100)}%"></div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500 mt-1">
                                <span>M√™s 6: ${formatarMoeda(economiaMensal * 6)}</span>
                                <span>Investimento: ${formatarMoeda(custoMedio)}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recomenda√ß√µes de Brayan Araujo Contador -->
                    <div class="card bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200">
                        <h4 class="font-bold text-blue-900 mb-4 flex items-center gap-2">
                            <i class="fas fa-user-tie text-blue-600"></i>
                            Recomenda√ß√µes Espec√≠ficas por Brayan Araujo Contador
                        </h4>
                        
                        <div class="space-y-4">
                            <div class="flex items-start gap-3">
                                <div class="bg-blue-100 p-2 rounded-lg">
                                    <i class="fas fa-lightbulb text-blue-600"></i>
                                </div>
                                <div>
                                    <h5 class="font-semibold text-blue-800">Estrat√©gia de Implementa√ß√£o</h5>
                                    <p class="text-sm text-gray-700 mt-1">
                                        Baseado no seu faturamento de ${formatarMoeda(faturamentoAnual)}/ano, recomendo uma abordagem 
                                        ${porte === 'micro' || porte === 'pequena' ? 'focada em efici√™ncia de custos' : 'abrangente e estruturada'}.
                                        O investimento de ${formatarMoeda(custoMedio)} tem ROI de ${roiAnual.toFixed(0)}% ao ano.
                                    </p>
                                </div>
                            </div>
                            
                            <div class="flex items-start gap-3">
                                <div class="bg-green-100 p-2 rounded-lg">
                                    <i class="fas fa-check-circle text-green-600"></i>
                                </div>
                                <div>
                                    <h5 class="font-semibold text-green-800">Oportunidades Identificadas</h5>
                                    <ul class="list-disc pl-5 mt-1 space-y-1 text-sm text-gray-700">
                                        <li>Economia tribut√°ria mensal de ${formatarMoeda(economiaMensal)}</li>
                                        <li>Redu√ß√£o de ${((sistemaAtual.total - reforma.ivaLiquido) / sistemaAtual.total * 100).toFixed(1)}% na carga tribut√°ria</li>
                                        <li>Payback em ${mesesPayback.toFixed(1)} meses</li>
                                        <li>Vantagem competitiva com sistemas atualizados</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="flex items-start gap-3">
                                <div class="bg-yellow-100 p-2 rounded-lg">
                                    <i class="fas fa-exclamation-triangle text-yellow-600"></i>
                                </div>
                                <div>
                                    <h5 class="font-semibold text-yellow-800">Riscos e Mitiga√ß√µes</h5>
                                    <ul class="list-disc pl-5 mt-1 space-y-1 text-sm text-gray-700">
                                        <li>Regulamenta√ß√£o em mudan√ßa ‚Üí Monitoramento constante</li>
                                        <li>Curva de aprendizado ‚Üí Treinamento adequado da equipe</li>
                                        <li>Investimento inicial ‚Üí Estrat√©gia de financiamento</li>
                                        <li>Integra√ß√£o de sistemas ‚Üí Escolha de fornecedores qualificados</li>
                                    </ul>
                                </div>
                            </div>
                            
                            <div class="p-4 bg-white rounded-lg border mt-4">
                                <div class="text-center">
                                    <p class="font-semibold text-gray-800">Interessado em um plano personalizado?</p>
                                    <p class="text-sm text-gray-600 mt-1">Entre em contato para uma consultoria detalhada</p>
                                    <button onclick="abrirContatoConsultoria()" class="btn-primary mt-3 px-6 py-2 rounded-full">
                                        <i class="fas fa-calendar-check mr-2"></i>Agendar Consultoria
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            return html;
        }

        // ==================== FUN√á√ïES EXISTENTES ATUALIZADAS ====================
        
        function selecionarCenario(cenario) {
            cenarioAtual = cenario;
            document.querySelectorAll('input[name="cenario"]').forEach(radio => {
                radio.checked = radio.value === cenario;
            });
            
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('border-2', 'border-blue-500');
            });
            
            if (document.getElementById(`cenario-${cenario}`)) {
                document.getElementById(`cenario-${cenario}`).closest('.card').classList.add('border-2', 'border-blue-500');
            }
            
            atualizarCalculos();
        }

        function selecionarAnoTransicao(ano) {
            document.getElementById('anoTransicao').value = ano;
            
            document.querySelectorAll('.progress-step').forEach(step => {
                step.classList.remove('active', 'completed');
                const stepYear = parseInt(step.getAttribute('data-year'));
                if (stepYear === ano) {
                    step.classList.add('active');
                } else if (stepYear < ano) {
                    step.classList.add('completed');
                }
            });
            
            const descricoes = {
                2026: 'Fase de testes com 0,1% de CBS e IBS. Sistema antigo mantido em 99,8%. Adapta√ß√£o de sistemas em curso.',
                2027: 'CBS substitui totalmente PIS e COFINS (10,6%). IBS ainda em fase teste (0,1%). Fim da cumulatividade de PIS/COFINS.',
                2029: 'IBS inicia substitui√ß√£o gradual de ICMS e ISS (10%). Empresas j√° devem ter sistemas adaptados.',
                2033: 'Sistema completo. ICMS e ISS extintos. IVA Dual 100% implementado. Brasil com um dos IVAs mais altos do mundo.'
            };
            
            document.getElementById('progress-description').textContent = descricoes[ano] || '';
            atualizarCalculos();
        }

        function atualizarCalculos() {
            const dados = {
                faturamento: parseFloat(document.getElementById('faturamento').value) || 0,
                regime: document.getElementById('regime').value,
                setor: document.getElementById('setor').value,
                estado: document.getElementById('estado').value,
                percentualInsumos: parseFloat(document.getElementById('percentualInsumos').value) || 0,
                percentualAtivo: parseFloat(document.getElementById('percentualAtivo').value) || 0,
                folhaPagamento: parseFloat(document.getElementById('folhaPagamento').value) || 0,
                categoria: document.getElementById('categoria').value,
                anoTransicao: document.getElementById('anoTransicao').value
            };

            // Atualizar labels
            const faturamentoAnual = dados.faturamento * 12;
            document.getElementById('faturamentoAnual').textContent = 
                `Anual: ${formatarMoeda(faturamentoAnual)}`;
            
            document.getElementById('ano-atual-label').textContent = '2025';
            document.getElementById('ano-reforma-label').textContent = dados.anoTransicao;

            // Calcular sistema atual COM FUN√á√ÉO CORRIGIDA
            const sistemaAtual = calcularSistemaAtualCorrigido(dados);
            const liquidoAtual = dados.faturamento - sistemaAtual.total;
            const cargaAtual = (sistemaAtual.total / dados.faturamento) * 100;

            // Atualizar UI - Sistema Atual
            document.getElementById('fat-atual').textContent = formatarMoeda(dados.faturamento);
            document.getElementById('trib-atual-total').textContent = formatarMoeda(sistemaAtual.total);
            document.getElementById('liq-atual').textContent = formatarMoeda(liquidoAtual);
            document.getElementById('carga-atual').textContent = formatarPorcentagem(cargaAtual);

            // Detalhamento tributos atuais
            let detalhamentoHTML = '';
            if (sistemaAtual.erro) {
                detalhamentoHTML = `<div class="text-red-600 font-semibold p-3 bg-red-50 rounded-lg">‚ö†Ô∏è ${sistemaAtual.erro}</div>`;
            } else {
                sistemaAtual.detalhes.forEach(item => {
                    detalhamentoHTML += `
                        <div class="flex justify-between items-center py-2 px-3 bg-gray-50 rounded-lg">
                            <span class="text-gray-700">${item.nome}</span>
                            <span class="font-semibold">${formatarMoeda(item.valor)}</span>
                        </div>
                    `;
                });
            }
            document.getElementById('tributos-atual-detalhado').innerHTML = detalhamentoHTML;

            // Calcular reforma
            let tributoReformaFinal, cargaReforma, liquidoReforma;
            
            if (dados.anoTransicao === '2033') {
                const reforma = calcularIVADual(dados);
                tributoReformaFinal = reforma.ivaLiquido;
                
                // Atualizar UI - Reforma
                document.getElementById('cenario-aplicado').textContent = reforma.cenario;
                document.getElementById('aliquotaAplicada').textContent = formatarPorcentagem(reforma.aliquotaTotal);
                document.getElementById('cbs-valor').textContent = formatarMoeda(reforma.cbsBruto);
                document.getElementById('ibs-valor').textContent = formatarMoeda(reforma.ibsBruto);
                document.getElementById('trib-reforma-bruto').textContent = formatarMoeda(reforma.ivaBruto);
                document.getElementById('credito-insumos').textContent = formatarMoeda(reforma.creditoInsumos);
                document.getElementById('credito-ativo').textContent = formatarMoeda(reforma.creditoAtivoMensal);
                document.getElementById('credito-total').textContent = formatarMoeda(reforma.creditoTotal);
                document.getElementById('trib-liquido-reforma').textContent = formatarMoeda(reforma.ivaLiquido);
                
                // Imposto Seletivo
                if (reforma.impostoSeletivo > 0) {
                    document.getElementById('is-linha').style.display = 'flex';
                    document.getElementById('is-valor').textContent = formatarMoeda(reforma.impostoSeletivo);
                } else {
                    document.getElementById('is-linha').style.display = 'none';
                }
            } else {
                const transicao = calcularTransicao(dados, dados.anoTransicao);
                tributoReformaFinal = transicao.tributoTotal;
                
                const reforma = calcularIVADual(dados);
                document.getElementById('cenario-aplicado').textContent = 
                    `${reforma.cenario} (Transi√ß√£o ${(transicao.transicao.cbs * 100).toFixed(0)}% CBS / ${(transicao.transicao.ibs * 100).toFixed(0)}% IBS)`;
                document.getElementById('aliquotaAplicada').textContent = formatarPorcentagem(reforma.aliquotaTotal);
                document.getElementById('cbs-valor').textContent = formatarMoeda(transicao.cbsParcial);
                document.getElementById('ibs-valor').textContent = formatarMoeda(transicao.ibsParcial);
                document.getElementById('trib-reforma-bruto').textContent = 
                    formatarMoeda(transicao.cbsParcial + transicao.ibsParcial + transicao.sistemaAntigoParcial);
                document.getElementById('credito-insumos').textContent = formatarMoeda(reforma.creditoInsumos * transicao.transicao.ibs);
                document.getElementById('credito-ativo').textContent = formatarMoeda(reforma.creditoAtivoMensal * transicao.transicao.ibs);
                document.getElementById('credito-total').textContent = formatarMoeda(transicao.creditoParcial);
                document.getElementById('trib-liquido-reforma').textContent = formatarMoeda(transicao.tributoTotal);
                document.getElementById('is-linha').style.display = 'none';
            }
            
            liquidoReforma = dados.faturamento - tributoReformaFinal;
            cargaReforma = (tributoReformaFinal / dados.faturamento) * 100;
            
            document.getElementById('fat-reforma').textContent = formatarMoeda(dados.faturamento);
            document.getElementById('liq-reforma').textContent = formatarMoeda(liquidoReforma);
            document.getElementById('carga-reforma').textContent = formatarPorcentagem(cargaReforma);

            // Atualizar resumo executivo
            atualizarResumoExecutivo(dados, sistemaAtual, tributoReformaFinal);
            
            // Atualizar compara√ß√£o visual
            atualizarComparacaoVisual(sistemaAtual, tributoReformaFinal);

            // Gerar an√°lises avan√ßadas
            document.getElementById('analiseInternacional').innerHTML = gerarAnaliseInternacional(dados, sistemaAtual, tributoReformaFinal);
            document.getElementById('detalhamentoCustosImplantacao').innerHTML = gerarDetalhamentoCustosImplantacao(dados);

            // Gerar recomenda√ß√µes
            gerarRecomendacoes(dados, sistemaAtual, tributoReformaFinal);

            // Atualizar gr√°ficos
            atualizarGraficos(dados, sistemaAtual.total, tributoReformaFinal);

            // Atualizar timeline
            atualizarTimeline(dados);
            
            // Criar gr√°fico internacional
            setTimeout(() => {
                criarGraficoInternacional();
            }, 100);
        }

        function atualizarResumoExecutivo(dados, sistemaAtual, tributoReforma) {
            const cargaAtual = (sistemaAtual.total / dados.faturamento) * 100;
            const cargaReforma = (tributoReforma / dados.faturamento) * 100;
            const variacao = cargaReforma - cargaAtual;
            const impactoAnual = (tributoReforma - sistemaAtual.total) * 12;
            
            document.getElementById('resumo-carga-atual').textContent = formatarPorcentagem(cargaAtual, 1);
            document.getElementById('resumo-carga-reforma').textContent = formatarPorcentagem(cargaReforma, 1);
            document.getElementById('resumo-variacao').textContent = (variacao >= 0 ? '+' : '') + formatarPorcentagem(variacao, 1);
            document.getElementById('resumo-impacto-anual').textContent = formatarMoeda(impactoAnual);
            
            // Atualizar badge
            const badge = document.getElementById('resumo-badge');
            badge.className = 'badge ';
            if (variacao < -1) {
                badge.classList.add('badge-success');
                badge.textContent = 'ECONOMIA';
            } else if (variacao > 1) {
                badge.classList.add('badge-danger');
                badge.textContent = 'AUMENTO';
            } else {
                badge.classList.add('badge-neutral');
                badge.textContent = 'NEUTRO';
            }
        }

        function atualizarComparacaoVisual(sistemaAtual, tributoReforma) {
            const diferenca = tributoReforma - sistemaAtual.total;
            const cargaAtual = (sistemaAtual.total / (parseFloat(document.getElementById('faturamento').value) || 1)) * 100;
            const cargaReforma = (tributoReforma / (parseFloat(document.getElementById('faturamento').value) || 1)) * 100;
            
            document.getElementById('comparacao-atual').textContent = formatarMoeda(sistemaAtual.total);
            document.getElementById('comparacao-atual-porc').textContent = formatarPorcentagem(cargaAtual, 1) + ' de carga';
            
            document.getElementById('comparacao-reforma').textContent = formatarMoeda(tributoReforma);
            document.getElementById('comparacao-reforma-porc').textContent = formatarPorcentagem(cargaReforma, 1) + ' de carga';
            
            document.getElementById('comparacao-diferenca').textContent = formatarMoeda(Math.abs(diferenca));
            
            const badge = document.getElementById('comparacao-badge');
            const descricao = document.getElementById('comparacao-descricao');
            
            if (diferenca < -1000) {
                badge.className = 'badge badge-success';
                badge.textContent = 'ECONOMIA';
                descricao.textContent = `Redu√ß√£o de ${formatarPorcentagem(Math.abs((diferenca/sistemaAtual.total)*100), 1)} na carga tribut√°ria`;
            } else if (diferenca > 1000) {
                badge.className = 'badge badge-danger';
                badge.textContent = 'AUMENTO';
                descricao.textContent = `Aumento de ${formatarPorcentagem((diferenca/sistemaAtual.total)*100, 1)} na carga tribut√°ria`;
            } else {
                badge.className = 'badge badge-neutral';
                badge.textContent = 'NEUTRO';
                descricao.textContent = 'Altera√ß√£o insignificante na carga tribut√°ria';
            }
        }

        // ==================== FUN√á√ïES EXISTENTES MANTIDAS ====================
        
        function gerarRecomendacoes(dados, sistemaAtual, tributoReforma) {
            const diferenca = tributoReforma - sistemaAtual.total;
            const percentualImpacto = sistemaAtual.total > 0 ? (diferenca / sistemaAtual.total) * 100 : 0;
            const faturamentoAnual = dados.faturamento * 12;
            const reforma = calcularIVADual(dados);
            
            let recomendacoesArray = [];

            // 1. AN√ÅLISE DE IMPACTO
            if (diferenca < -5000) {
                recomendacoesArray.push({
                    tipo: 'success',
                    icone: 'üí∞',
                    titulo: 'CEN√ÅRIO FAVOR√ÅVEL - Redu√ß√£o Tribut√°ria Significativa',
                    texto: `Sua empresa ter√° uma <strong>economia de ${formatarMoeda(Math.abs(diferenca))}/m√™s</strong> (${formatarMoeda(Math.abs(diferenca * 12))}/ano). Esta redu√ß√£o de ${formatarPorcentagem(Math.abs(percentualImpacto))} representa uma vantagem competitiva importante. <strong>Brayan Araujo Contador recomenda:</strong> Reinvestir parte dessa economia em tecnologia e capacita√ß√£o.`
                });
            } else if (diferenca >= 5000) {
                recomendacoesArray.push({
                    tipo: 'danger',
                    icone: '‚ö†Ô∏è',
                    titulo: 'ATEN√á√ÉO - Aumento da Carga Tribut√°ria',
                    texto: `A reforma resultar√° em um <strong>aumento de ${formatarMoeda(diferenca)}/m√™s</strong> (${formatarMoeda(diferenca * 12)}/ano). Aumento de ${formatarPorcentagem(percentualImpacto)} nos tributos. <strong>Brayan Araujo Contador recomenda:</strong> Agende uma consultoria urgente para planejamento tribut√°rio estrat√©gico.`
                });
            } else {
                recomendacoesArray.push({
                    tipo: 'info',
                    icone: '‚ÑπÔ∏è',
                    titulo: 'Impacto Neutro ou Marginal',
                    texto: `O impacto ser√° pr√≥ximo da neutralidade, com varia√ß√£o de ${diferenca >= 0 ? '+' : ''}${formatarMoeda(diferenca)}/m√™s. <strong>Brayan Araujo Contador recomenda:</strong> Foque em efici√™ncia operacional e formaliza√ß√£o de fornecedores para maximizar cr√©ditos.`
                });
            }

            // 2. ESTRAT√âGIAS DE CR√âDITOS
            if (dados.percentualInsumos < 40) {
                recomendacoesArray.push({
                    tipo: 'warning',
                    icone: 'üí°',
                    titulo: 'OPORTUNIDADE: Maximize seus Cr√©ditos de IVA',
                    texto: `Seus insumos representam apenas ${dados.percentualInsumos}% do faturamento, gerando cr√©ditos de ${formatarMoeda(reforma.creditoInsumos)}/m√™s. <strong>A√á√ÉO RECOMENDADA:</strong> Revise sua cadeia de fornecedores, formalize compras informais. Cada 10% a mais em insumos formalizados pode gerar ${formatarMoeda((dados.faturamento * 0.1) * (reforma.aliquotaTotal / 100))}/m√™s em cr√©ditos adicionais.`
                });
            }

            // 3. SETORES ESPEC√çFICOS
            if (dados.setor === 'energia') {
                recomendacoesArray.push({
                    tipo: 'info',
                    icone: '‚ö°',
                    titulo: 'Setor de Energia - Tratamento Especial',
                    texto: `O setor de energia ter√° al√≠quota reduzida estimada em 14% (vs 26,5% geral). <strong>Brayan Araujo Contador recomenda:</strong> Aproveite esta vantagem competitiva, mas aten√ß√£o √† regulamenta√ß√£o espec√≠fica do setor que ainda ser√° definida.`
                });
            } else if (dados.setor === 'telecom') {
                recomendacoesArray.push({
                    tipo: 'warning',
                    icone: 'üì±',
                    titulo: 'Telecomunica√ß√µes - ISS Mantido',
                    texto: `O setor de telecomunica√ß√µes provavelmente manter√° o ISS municipal al√©m do IBS. <strong>Brayan Araujo Contador recomenda:</strong> Planeje-se para cumulatividade parcial. Consulte legisla√ß√£o municipal espec√≠fica de cada cidade onde opera.`
                });
            }

            // 4. NOVO REGIME SIMPLIFICADO
            if (dados.regime === 'simples-futuro') {
                recomendacoesArray.push({
                    tipo: 'success',
                    icone: 'üîÑ',
                    titulo: 'Novo Regime Simplificado - Grande Oportunidade',
                    texto: `Voc√™ optou pelo novo regime simplificado p√≥s-reforma (al√≠quota √∫nica ~10%). <strong>Brayan Araujo Contador recomenda:</strong> Esta pode ser excelente op√ß√£o para empresas com faturamento at√© R$ 4,8 milh√µes e baixa necessidade de cr√©ditos.`
                });
            }

            // 5. CONSULTORIA ESPECIALIZADA
            if (Math.abs(diferenca) > 10000 || faturamentoAnual > 2000000) {
                recomendacoesArray.push({
                    tipo: 'danger',
                    icone: 'üë®‚Äçüíº',
                    titulo: 'RECOMENDA√á√ÉO CR√çTICA - Consultoria Especializada',
                    texto: `Devido ao impacto significativo (${diferenca >= 0 ? 'aumento' : 'economia'} de ${formatarMoeda(Math.abs(diferenca * 12))}/ano), √© <strong>ESSENCIAL</strong> contratar consultoria tribut√°ria especializada. <strong>Brayan Araujo Contador oferece:</strong> An√°lise personalizada, planejamento estrat√©gico e implementa√ß√£o do IVA. Entre em contato: brayancontabilidade@gmail.com`
                });
            }

            // 6. TIMING ESTRAT√âGICO
            const anoAtual = new Date().getFullYear();
            const anosPara2033 = 2033 - anoAtual;
            recomendacoesArray.push({
                tipo: 'info',
                icone: '‚è∞',
                titulo: 'Timing Estrat√©gico para Decis√µes',
                texto: `
                    <div class="space-y-3">
                        <p>Restam <strong>${anosPara2033} anos</strong> at√© a implementa√ß√£o total do IVA Dual (2033).</p>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <strong>Agenda Recomendada:</strong>
                            <ul class="list-disc pl-5 mt-2 space-y-1">
                                <li><strong>${anoAtual + 1}:</strong> Diagn√≥stico completo e planejamento estrat√©gico</li>
                                <li><strong>2026:</strong> Adapta√ß√£o de sistemas e cadastro de cr√©ditos</li>
                                <li><strong>2027:</strong> Otimiza√ß√£o de cadeia de fornecedores</li>
                                <li><strong>2029+:</strong> Ajustes finos e otimiza√ß√µes cont√≠nuas</li>
                            </ul>
                        </div>
                    </div>
                `
            });

            // Renderizar recomenda√ß√µes
            const html = recomendacoesArray.map(rec => {
                const alertType = rec.tipo === 'success' ? 'alert-success' : 
                                rec.tipo === 'danger' ? 'alert-danger' : 
                                rec.tipo === 'warning' ? 'alert-warning' : 'alert-info';
                
                return `
                    <div class="alert-box ${alertType}">
                        <div class="flex items-start gap-3">
                            <div class="text-2xl">${rec.icone}</div>
                            <div>
                                <h3 class="font-bold text-lg mb-2">${rec.titulo}</h3>
                                <div class="text-sm leading-relaxed">${rec.texto}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('recomendacoes').innerHTML = html;
        }

        function atualizarGraficos(dados, tributoAtual, tributoReforma) {
            // Destruir gr√°ficos existentes
            Object.values(charts).forEach(chart => {
                if (chart && typeof chart.destroy === 'function') {
                    chart.destroy();
                }
            });
            charts = {};

            const reforma = calcularIVADual(dados);
            const estadoAtual = dados.estado;

            // 1. Gr√°fico Comparativo
            const ctxComp = document.getElementById('chartComparativo').getContext('2d');
            charts.comparativo = new Chart(ctxComp, {
                type: 'bar',
                data: {
                    labels: ['Sistema Atual', 'IVA Dual P√≥s-Reforma'],
                    datasets: [
                        {
                            label: 'Tributos Mensais (R$)',
                            data: [tributoAtual, tributoReforma],
                            backgroundColor: ['#3b82f6', '#8b5cf6'],
                            borderColor: ['#2563eb', '#7c3aed'],
                            borderWidth: 2,
                            borderRadius: 8,
                            borderSkipped: false,
                        },
                        {
                            label: 'Carga Tribut√°ria (%)',
                            data: [
                                (tributoAtual / dados.faturamento) * 100,
                                (tributoReforma / dados.faturamento) * 100
                            ],
                            type: 'line',
                            yAxisID: 'y1',
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            pointRadius: 6,
                            pointBackgroundColor: '#10b981',
                            fill: false,
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index',
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Comparativo de Carga Tribut√°ria - Valores Absolutos e Percentuais',
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            padding: { bottom: 20 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.datasetIndex === 0) {
                                        label += formatarMoeda(context.parsed.y);
                                    } else {
                                        label += formatarPorcentagem(context.parsed.y);
                                    }
                                    return label;
                                }
                            }
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Valor em R$',
                                font: {
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatarMoeda(value);
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Carga %',
                                font: {
                                    weight: 'bold'
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatarPorcentagem(value);
                                }
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        }
                    }
                }
            });

            // 2. Gr√°fico Cascata
            const ctxCascata = document.getElementById('chartCascata').getContext('2d');
            const cascataData = [
                reforma.ivaBruto,
                -reforma.creditoInsumos,
                -reforma.creditoAtivoMensal,
                reforma.ivaLiquido
            ];
            
            const cascataLabels = [
                'IVA Bruto',
                'Cr√©dito Insumos',
                'Cr√©dito Ativo',
                'IVA L√≠quido'
            ];
            
            const cascataColors = [
                '#ef4444',
                '#10b981',
                '#3b82f6',
                '#f59e0b'
            ];
            
            charts.cascata = new Chart(ctxCascata, {
                type: 'bar',
                data: {
                    labels: cascataLabels,
                    datasets: [{
                        data: cascataData,
                        backgroundColor: cascataColors,
                        borderColor: cascataColors.map(color => color.replace('0.8', '1')),
                        borderWidth: 1,
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Fluxo de C√°lculo do IVA - Gr√°fico Cascata',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed.y;
                                    const prefix = value < 0 ? '-' : '';
                                    return `${context.label}: ${prefix}${formatarMoeda(Math.abs(value))}`;
                                }
                            }
                        },
                        datalabels: {
                            display: true,
                            color: 'white',
                            font: {
                                weight: 'bold'
                            },
                            formatter: function(value) {
                                return formatarMoeda(Math.abs(value));
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatarMoeda(value);
                                }
                            }
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });

            // 3. Gr√°fico de Transi√ß√£o
            const anosTransicao = [2026, 2027, 2028, 2029, 2030, 2031, 2032, 2033];
            const tributosPorAno = anosTransicao.map(ano => {
                const trans = calcularTransicao(dados, ano);
                return trans.tributoTotal;
            });
            
            const ctxTrans = document.getElementById('chartTransicao').getContext('2d');
            charts.transicao = new Chart(ctxTrans, {
                type: 'line',
                data: {
                    labels: anosTransicao,
                    datasets: [
                        {
                            label: 'Tributos durante Transi√ß√£o',
                            data: tributosPorAno,
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            borderWidth: 4,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 6,
                            pointBackgroundColor: '#8b5cf6',
                            pointBorderColor: 'white',
                            pointBorderWidth: 2
                        },
                        {
                            label: 'Sistema Atual (Refer√™ncia)',
                            data: Array(8).fill(tributoAtual),
                            borderColor: '#3b82f6',
                            borderWidth: 2,
                            borderDash: [5, 5],
                            fill: false,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Evolu√ß√£o da Carga Tribut√°ria durante a Transi√ß√£o (2026-2033)',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${formatarMoeda(context.parsed.y)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return formatarMoeda(value);
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(0, 0, 0, 0.1)'
                            }
                        }
                    }
                }
            });

            // 4. Gr√°fico de Estados
            const estados = Object.keys(INFO_ESTADOS_CORRIGIDO);
            const cargasEstados = estados.map(sigla => {
                const dadosEstado = { ...dados, estado: sigla };
                const sistema = calcularSistemaAtualCorrigido(dadosEstado);
                return (sistema.total / dados.faturamento) * 100;
            });
            
            const scores = estados.map(sigla => {
                const estadoInfo = INFO_ESTADOS_CORRIGIDO[sigla];
                return estadoInfo.score;
            });
            
            const isEstadoAtual = estados.map(sigla => sigla === estadoAtual);
            
            const ctxEstados = document.getElementById('chartEstados').getContext('2d');
            charts.estados = new Chart(ctxEstados, {
                type: 'bar',
                data: {
                    labels: estados,
                    datasets: [
                        {
                            label: 'Carga Tribut√°ria Atual (%)',
                            data: cargasEstados,
                            backgroundColor: cargasEstados.map((carga, index) => 
                                isEstadoAtual[index] ? '#8b5cf6' : '#3b82f6'
                            ),
                            borderColor: cargasEstados.map((carga, index) => 
                                isEstadoAtual[index] ? '#7c3aed' : '#2563eb'
                            ),
                            borderWidth: 2,
                            borderRadius: 6,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Score de Atratividade',
                            data: scores,
                            type: 'line',
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 3,
                            pointRadius: 6,
                            pointBackgroundColor: scores.map((score, index) => 
                                isEstadoAtual[index] ? '#8b5cf6' : '#10b981'
                            ),
                            yAxisID: 'y1',
                            fill: false,
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'An√°lise Comparativa por Estado - Carga Atual vs. Atratividade',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (context.datasetIndex === 0) {
                                        return `Carga: ${formatarPorcentagem(context.parsed.y)}`;
                                    } else {
                                        return `Score: ${context.parsed.y}/10`;
                                    }
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Carga Tribut√°ria (%)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatarPorcentagem(value);
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Score de Atratividade'
                            },
                            min: 0,
                            max: 10,
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });

            // 5. Gr√°fico por Setor
            const setores = ['comercio', 'industria', 'servicos-gerais', 'servicos-tecnologia', 'servicos-engenharia', 'energia', 'telecom'];
            const setorLabels = ['Com√©rcio', 'Ind√∫stria', 'Servi√ßos Gerais', 'TI', 'Engenharia', 'Energia', 'Telecom'];
            
            const cargasPorSetor = setores.map(setor => {
                const dadosSetor = { ...dados, setor: setor };
                const sistema = calcularSistemaAtualCorrigido(dadosSetor);
                const reformaSetor = calcularIVADual(dadosSetor);
                return {
                    atual: (sistema.total / dados.faturamento) * 100,
                    reforma: (reformaSetor.ivaLiquido / dados.faturamento) * 100
                };
            });
            
            const ctxSetor = document.getElementById('chartSetor').getContext('2d');
            charts.setor = new Chart(ctxSetor, {
                type: 'bar',
                data: {
                    labels: setorLabels,
                    datasets: [
                        {
                            label: 'Carga Atual',
                            data: cargasPorSetor.map(s => s.atual),
                            backgroundColor: '#3b82f6',
                            borderColor: '#2563eb',
                            borderWidth: 2,
                            borderRadius: 6
                        },
                        {
                            label: 'P√≥s-Reforma',
                            data: cargasPorSetor.map(s => s.reforma),
                            backgroundColor: '#8b5cf6',
                            borderColor: '#7c3aed',
                            borderWidth: 2,
                            borderRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Impacto da Reforma por Setor Econ√¥mico',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${formatarPorcentagem(context.parsed.y)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Carga Tribut√°ria (%)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatarPorcentagem(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        function criarGraficoInternacional() {
            const ctx = document.getElementById('chartInternacional');
            if (!ctx) return;
            
            const context = ctx.getContext('2d');
            
            // Destruir gr√°fico existente
            if (charts.internacional) {
                charts.internacional.destroy();
            }
            
            const paises = Object.keys(COMPARACAO_INTERNACIONAL).slice(0, 8);
            const labels = paises.map(key => COMPARACAO_INTERNACIONAL[key].nome);
            const dadosCarga = paises.map(key => COMPARACAO_INTERNACIONAL[key].cargaTotal);
            const cores = paises.map(key => 
                key.includes('brasil-atual') ? '#ef4444' : 
                key.includes('brasil-pos') ? '#8b5cf6' : 
                '#3b82f6'
            );
            
            charts.internacional = new Chart(context, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Carga Tribut√°ria Total (% do PIB)',
                        data: dadosCarga,
                        backgroundColor: cores,
                        borderColor: cores.map(cor => cor.replace('0.8', '1')),
                        borderWidth: 2,
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Comparativo Internacional de Carga Tribut√°ria Empresarial',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const pais = COMPARACAO_INTERNACIONAL[paises[context.dataIndex]];
                                    return [
                                        `Carga Total: ${pais.cargaTotal}% do PIB`,
                                        `IVA/VAT: ${pais.ivaVat > 0 ? pais.ivaVat + '%' : 'N√£o tem'}`,
                                        `Complexidade: ${pais.complexidade}/10`,
                                        `Ranking DB: ${pais.rankingDoingBusiness}¬∫`
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '% do PIB em tributos empresariais'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        function atualizarTimeline(dados) {
            const timelineItems = [
                {
                    ano: '2026',
                    titulo: 'Fase Experimental',
                    descricao: 'CBS e IBS iniciam em car√°ter experimental com 0,1% cada. Sistema antigo mantido em 99,8%. Empresas come√ßam adapta√ß√£o de sistemas.',
                    acoes: ['Teste de sistemas', 'Cadastro de cr√©ditos', 'Treinamento inicial'],
                    cor: 'blue'
                },
                {
                    ano: '2027',
                    titulo: 'CBS Entra em Vigor',
                    descricao: 'CBS substitui TOTALMENTE PIS e COFINS. Al√≠quota CBS: ~10,6% (cen√°rio base). IBS ainda em fase teste (0,1%). Fim da cumulatividade de PIS/COFINS.',
                    acoes: ['Implementa√ß√£o CBS', 'Ajuste de processos', 'Monitoramento cr√©ditos'],
                    cor: 'indigo'
                },
                {
                    ano: '2029',
                    titulo: 'IBS Come√ßa Substitui√ß√£o',
                    descricao: 'IBS inicia substitui√ß√£o gradual de ICMS e ISS (10%). Empresas j√° devem estar com sistemas adaptados. Cr√©ditos integrais come√ßam a fazer diferen√ßa real.',
                    acoes: ['Transi√ß√£o ICMS/ISS', 'Otimiza√ß√£o cr√©ditos', 'Ajuste precifica√ß√£o'],
                    cor: 'purple'
                },
                {
                    ano: '2033',
                    titulo: 'Sistema Completo',
                    descricao: 'ICMS e ISS EXTINTOS. IVA Dual 100% implementado. Al√≠quota estimada: 25-28% (CBS + IBS). Brasil com um dos IVAs mais altos do mundo. Sistema n√£o-cumulativo pleno.',
                    acoes: ['Sistema consolidado', 'Otimiza√ß√£o cont√≠nua', 'An√°lise competitiva'],
                    cor: 'red'
                }
            ];

            let html = '<div class="space-y-8">';
            
            timelineItems.forEach(item => {
                const transicao = calcularTransicao(dados, item.ano);
                const cargaEfetiva = (transicao.tributoTotal / dados.faturamento) * 100;
                
                html += `
                    <div class="flex flex-col md:flex-row gap-6">
                        <div class="md:w-1/4">
                            <div class="bg-${item.cor}-100 text-${item.cor}-900 rounded-xl p-6 text-center">
                                <div class="text-3xl font-bold mb-2">${item.ano}</div>
                                <div class="text-sm font-semibold">${item.titulo}</div>
                                <div class="mt-4 text-lg font-bold">
                                    ${formatarPorcentagem(cargaEfetiva)}
                                </div>
                                <div class="text-sm text-${item.cor}-700">carga efetiva</div>
                            </div>
                        </div>
                        
                        <div class="md:w-3/4">
                            <div class="bg-white border border-gray-200 rounded-xl p-6">
                                <p class="text-gray-700 mb-4">${item.descricao}</p>
                                
                                <div class="mb-4">
                                    <div class="text-sm font-semibold text-gray-600 mb-2">Tributo estimado para sua empresa:</div>
                                    <div class="text-2xl font-bold text-${item.cor}-600">
                                        ${formatarMoeda(transicao.tributoTotal)}/m√™s
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="text-sm font-semibold text-gray-600 mb-2">A√ß√µes Recomendadas:</div>
                                    <div class="flex flex-wrap gap-2">
                                        ${item.acoes.map(acao => `
                                            <span class="bg-${item.cor}-50 text-${item.cor}-700 px-3 py-1 rounded-full text-sm">
                                                ${acao}
                                            </span>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            document.getElementById('timeline').innerHTML = html;
        }

        // ==================== FUN√á√ïES DE PERSIST√äNCIA ====================
        
        function salvarSimulacao() {
            const dados = {
                faturamento: document.getElementById('faturamento').value,
                regime: document.getElementById('regime').value,
                setor: document.getElementById('setor').value,
                estado: document.getElementById('estado').value,
                cargaAtual: document.getElementById('carga-atual').textContent,
                cargaReforma: document.getElementById('carga-reforma').textContent,
                impacto: document.getElementById('resumo-impacto-anual').textContent,
                data: new Date().toLocaleString('pt-BR')
            };
            
            historicoSimulacoes.unshift(dados);
            if (historicoSimulacoes.length > 10) {
                historicoSimulacoes = historicoSimulacoes.slice(0, 10);
            }
            
            localStorage.setItem('historicoSimulacoes', JSON.stringify(historicoSimulacoes));
            
            alert('‚úÖ Simula√ß√£o salva com sucesso! Voc√™ pode acess√°-la no "Hist√≥rico".');
        }

        function carregarSimulacoes() {
            document.getElementById('historicoSimulacoes').style.display = 'block';
            const lista = document.getElementById('listaSimulacoes');
            
            if (historicoSimulacoes.length === 0) {
                lista.innerHTML = '<p class="text-gray-500 text-center py-8">Nenhuma simula√ß√£o salva ainda.</p>';
                return;
            }
            
            let html = '<div class="space-y-4">';
            historicoSimulacoes.forEach((sim, index) => {
                const impactoNum = parseFloat(sim.impacto.replace('R$', '').replace('.', '').replace(',', '.'));
                
                html += `
                    <div class="card cursor-pointer hover:shadow-hard transition-all" onclick="carregarSimulacao(${index})">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-bold text-gray-800">${sim.setor} - ${sim.regime}</div>
                                <div class="text-sm text-gray-600 mt-1">
                                    Faturamento: R$ ${parseFloat(sim.faturamento).toLocaleString('pt-BR')} | 
                                    Estado: ${sim.estado}
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-xs text-gray-500">${sim.data}</div>
                                <div class="text-lg font-bold ${impactoNum < 0 ? 'text-green-600' : 'text-red-600'}">
                                    ${sim.impacto}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            lista.innerHTML = html;
        }

        function carregarSimulacao(index) {
            const sim = historicoSimulacoes[index];
            document.getElementById('faturamento').value = sim.faturamento;
            document.getElementById('regime').value = sim.regime;
            document.getElementById('setor').value = sim.setor;
            document.getElementById('estado').value = sim.estado;
            
            atualizarCalculos();
            document.getElementById('historicoSimulacoes').style.display = 'none';
        }

        function calcularCustosAdaptacao() {
            const html = `
                <div class="card-header">
                    <h3 class="text-2xl font-bold flex items-center gap-3">
                        <i class="fas fa-calculator text-purple-600"></i>
                        Calculadora de Custos de Adapta√ß√£o √† Reforma
                    </h3>
                </div>
                
                <div class="space-y-6">
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="card">
                            <label class="block text-sm font-semibold text-gray-700 mb-3">
                                Sistema ERP/Software
                            </label>
                            <select id="custoErp" class="w-full px-4 py-3 input-field rounded-lg">
                                <option value="500">B√°sico (R$ 500/m√™s)</option>
                                <option value="1500" selected>Intermedi√°rio (R$ 1.500/m√™s)</option>
                                <option value="5000">Avan√ßado (R$ 5.000/m√™s)</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-2">Sistema compat√≠vel com IVA Dual</p>
                        </div>
                        
                        <div class="card">
                            <label class="block text-sm font-semibold text-gray-700 mb-3">
                                Treinamento da Equipe
                            </label>
                            <select id="custoTreinamento" class="w-full px-4 py-3 input-field rounded-lg">
                                <option value="1000">B√°sico (R$ 1.000)</option>
                                <option value="3000" selected>Completo (R$ 3.000)</option>
                                <option value="8000">Especializado (R$ 8.000)</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-2">Capacita√ß√£o para nova tributa√ß√£o</p>
                        </div>
                        
                        <div class="card">
                            <label class="block text-sm font-semibold text-gray-700 mb-3">
                                Consultoria Especializada
                            </label>
                            <select id="custoConsultoria" class="w-full px-4 py-3 input-field rounded-lg">
                                <option value="5000">Planejamento (R$ 5.000)</option>
                                <option value="15000" selected>Implementa√ß√£o (R$ 15.000)</option>
                                <option value="30000">Completa (R$ 30.000)</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-2">An√°lise personalizada por especialista</p>
                        </div>
                    </div>
                    
                    <div class="card bg-gradient-to-r from-yellow-50 to-amber-50 border-yellow-200">
                        <div class="flex flex-col md:flex-row justify-between items-center">
                            <div>
                                <h4 class="font-bold text-yellow-900 text-lg">Custo Total de Adapta√ß√£o</h4>
                                <p class="text-sm text-yellow-800">Investimento necess√°rio para transi√ß√£o completa</p>
                            </div>
                            <div class="text-3xl font-bold text-yellow-700 mt-4 md:mt-0" id="custoAdaptacaoTotal">R$ 0,00</div>
                        </div>
                        <div class="mt-4">
                            <button onclick="calcularTotalAdaptacao()" class="btn-primary px-6 py-2 rounded-full">
                                <i class="fas fa-calculator mr-2"></i>Calcular
                            </button>
                            <button onclick="fecharCustosAdaptacao()" class="btn-secondary px-6 py-2 rounded-full ml-3">
                                <i class="fas fa-times mr-2"></i>Fechar
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('custosAdaptacao').innerHTML = html;
            document.getElementById('custosAdaptacao').style.display = 'block';
            calcularTotalAdaptacao();
        }

        function calcularTotalAdaptacao() {
            const custoErp = parseFloat(document.getElementById('custoErp').value) || 0;
            const custoTreinamento = parseFloat(document.getElementById('custoTreinamento').value) || 0;
            const custoConsultoria = parseFloat(document.getElementById('custoConsultoria').value) || 0;
            
            const total = custoErp * 12 + custoTreinamento + custoConsultoria;
            document.getElementById('custoAdaptacaoTotal').textContent = formatarMoeda(total);
        }

        function fecharCustosAdaptacao() {
            document.getElementById('custosAdaptacao').style.display = 'none';
        }

        function simularPrecificacao() {
            const faturamento = parseFloat(document.getElementById('faturamento').value) || 0;
            const margemAtual = prompt('Qual sua margem de lucro atual (%)?', '20');
            const margemDesejada = prompt('Qual margem de lucro deseja manter ap√≥s a reforma (%)?', '20');
            
            if (!margemAtual || !margemDesejada) return;
            
            const sistemaAtual = calcularSistemaAtualCorrigido({
                faturamento: faturamento,
                regime: document.getElementById('regime').value,
                setor: document.getElementById('setor').value,
                estado: document.getElementById('estado').value,
                folhaPagamento: document.getElementById('folhaPagamento').value
            });
            
            const reforma = calcularIVADual({
                faturamento: faturamento,
                categoria: document.getElementById('categoria').value,
                percentualInsumos: document.getElementById('percentualInsumos').value,
                percentualAtivo: document.getElementById('percentualAtivo').value
            });
            
            const custoAtual = faturamento * (1 - (parseFloat(margemAtual)/100));
            const precoAtual = custoAtual + sistemaAtual.total;
            
            const custoReforma = faturamento * (1 - (parseFloat(margemDesejada)/100));
            const precoReformaNecessario = custoReforma + reforma.ivaLiquido;
            
            const aumentoPercentual = ((precoReformaNecessario - precoAtual) / precoAtual) * 100;
            
            alert(`üìä PRECIFICA√á√ÉO SIMULADA\n\n` +
                  `Pre√ßo atual necess√°rio: ${formatarMoeda(precoAtual)}\n` +
                  `Pre√ßo p√≥s-reforma necess√°rio: ${formatarMoeda(precoReformaNecessario)}\n` +
                  `Aumento necess√°rio: ${aumentoPercentual.toFixed(1)}%\n\n` +
                  `üí° Para manter margem de ${margemDesejada}%, voc√™ precisar√° aumentar os pre√ßos em ${aumentoPercentual.toFixed(1)}%.`);
        }

        function exportarParaCSV() {
            const dados = {
                faturamento: document.getElementById('faturamento').value,
                regime: document.getElementById('regime').value,
                setor: document.getElementById('setor').value,
                estado: document.getElementById('estado').value,
                cargaAtual: document.getElementById('carga-atual').textContent,
                cargaReforma: document.getElementById('carga-reforma').textContent,
                impactoAnual: document.getElementById('resumo-impacto-anual').textContent,
                data: new Date().toLocaleString('pt-BR')
            };
            
            let csv = 'Par√¢metro,Valor\n';
            csv += `Faturamento Mensal,R$ ${dados.faturamento}\n`;
            csv += `Regime Tribut√°rio,${dados.regime}\n`;
            csv += `Setor,${dados.setor}\n`;
            csv += `Estado,${dados.estado}\n`;
            csv += `Carga Tribut√°ria Atual,${dados.cargaAtual}\n`;
            csv += `Carga P√≥s-Reforma,${dados.cargaReforma}\n`;
            csv += `Impacto Financeiro Anual,${dados.impactoAnual}\n`;
            csv += `Data da Simula√ß√£o,${dados.data}\n`;
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `simulacao-reforma-${new Date().toISOString().slice(0,10)}.csv`;
            a.click();
            
            alert('‚úÖ CSV exportado com sucesso!');
        }

        function salvarComoPDF() {
            alert('üìÑ Para salvar como PDF, use a fun√ß√£o de impress√£o do navegador (Ctrl+P) e selecione "Salvar como PDF" como destino.');
        }

        function compartilhar() {
            const texto = `Simulei o impacto da Reforma Tribut√°ria na minha empresa com a calculadora profissional do Brayan Araujo Contador. Confira esta ferramenta incr√≠vel!`;
            const url = window.location.href;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Calculadora Reforma Tribut√°ria | Brayan Araujo Contador',
                    text: texto,
                    url: url
                });
            } else {
                navigator.clipboard.writeText(`${texto}\n\n${url}`).then(() => {
                    alert('‚úÖ Link copiado para a √°rea de transfer√™ncia! Compartilhe com seus colegas e parceiros.');
                });
            }
        }

        function abrirContatoConsultoria() {
            const dados = {
                faturamento: parseFloat(document.getElementById('faturamento').value) || 0,
                regime: document.getElementById('regime').value,
                setor: document.getElementById('setor').value,
                estado: document.getElementById('estado').value,
                folhaPagamento: parseFloat(document.getElementById('folhaPagamento').value) || 0
            };
            
            const sistemaAtual = calcularSistemaAtualCorrigido(dados);
            const reforma = calcularIVADual(dados);
            const economiaMensal = sistemaAtual.total - reforma.ivaLiquido;
            
            const mensagem = `Ol√° Brayan, gostaria de agendar uma consultoria sobre a Reforma Tribut√°ria.\n\n` +
                           `Minha empresa:\n` +
                           `- Faturamento: ${formatarMoeda(dados.faturamento)}/m√™s\n` +
                           `- Setor: ${document.getElementById('setor').options[document.getElementById('setor').selectedIndex].text}\n` +
                           `- Regime: ${document.getElementById('regime').options[document.getElementById('regime').selectedIndex].text}\n` +
                           `- Economia estimada: ${formatarMoeda(economiaMensal)}/m√™s\n\n` +
                           `Podemos agendar uma conversa?`;
            
            const telefone = "5521991577383";
            const url = `https://wa.me/${telefone}?text=${encodeURIComponent(mensagem)}`;
            window.open(url, '_blank');
        }

        // ==================== EVENT LISTENERS ====================
        
        document.addEventListener('DOMContentLoaded', function() {
            // Event listeners para inputs
            document.getElementById('faturamento').addEventListener('input', atualizarCalculos);
            document.getElementById('regime').addEventListener('change', function() {
                const regime = this.value;
                let infoText = '';
                if (regime === 'simples') {
                    infoText = 'Limite: R$ 4,8 milh√µes/ano';
                } else if (regime === 'simples-futuro') {
                    infoText = 'Novo regime p√≥s-reforma (al√≠quota √∫nica ~10%)';
                } else if (regime === 'presumido') {
                    infoText = 'Lucro estimado por lei';
                } else {
                    infoText = 'Lucro efetivo cont√°bil';
                }
                document.getElementById('regimeInfo').textContent = infoText;
                atualizarCalculos();
            });
            
            document.getElementById('setor').addEventListener('change', atualizarCalculos);
            document.getElementById('estado').addEventListener('change', atualizarCalculos);
            document.getElementById('folhaPagamento').addEventListener('input', atualizarCalculos);
            document.getElementById('categoria').addEventListener('change', atualizarCalculos);
            document.getElementById('anoTransicao').addEventListener('change', atualizarCalculos);
            document.getElementById('regimeApuracao').addEventListener('change', atualizarCalculos);

            document.getElementById('percentualInsumos').addEventListener('input', function() {
                const valor = this.value;
                document.getElementById('insumosValor').textContent = valor + '%';
                
                let alerta = '';
                if (valor < 20) {
                    alerta = '‚ö†Ô∏è Baixo percentual! Voc√™ ter√° poucos cr√©ditos de IVA. Revise sua cadeia de fornecedores.';
                    document.getElementById('insumosAlert').className = 'bg-red-50 text-red-700 p-3 rounded-lg border border-red-200';
                } else if (valor >= 60) {
                    alerta = '‚úÖ Excelente! Alto volume de cr√©ditos tribut√°rios. √ìtimo posicionamento para a reforma.';
                    document.getElementById('insumosAlert').className = 'bg-green-50 text-green-700 p-3 rounded-lg border border-green-200';
                } else {
                    alerta = 'üí° Razo√°vel. Busque aumentar formaliza√ß√£o de compras para maximizar cr√©ditos dispon√≠veis.';
                    document.getElementById('insumosAlert').className = 'bg-blue-50 text-blue-700 p-3 rounded-lg border border-blue-200';
                }
                document.getElementById('insumosAlert').textContent = alerta;
                
                atualizarCalculos();
            });

            document.getElementById('percentualAtivo').addEventListener('input', function() {
                const valor = this.value;
                document.getElementById('ativoValor').textContent = valor + '%';
                atualizarCalculos();
            });

            // Dark Mode
            document.getElementById('darkModeToggle').addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                this.innerHTML = document.body.classList.contains('dark-mode') ? 
                    '<i class="fas fa-sun mr-2"></i>Modo Claro' : 
                    '<i class="fas fa-moon mr-2"></i>Modo Escuro';
            });

            // Exportar CSV
            document.getElementById('exportCSV').addEventListener('click', exportarParaCSV);

            // Exportar PDF
            document.getElementById('exportPDF').addEventListener('click', function() {
                window.print();
            });

            // Inicializar
            atualizarCalculos();
            selecionarAnoTransicao(2033);
            abrirTab('tab-geral');
            abrirChartTab('chart-comparativo');
        });
    </script>
</body>
</html>
